(function(){function b(r){return function(d,g,f,c){g=x(g,c,4);var b=!B(d)&&a.keys(d),t=(b||d).length,e=0<r?0:t-1;3>arguments.length&&(f=d[b?b[e]:e],e+=r);for(var h=g,l=f;0<=e&&e<t;e+=r)var q=b?b[e]:e,l=h(l,d[q],q,d);return l}}function m(a){return function(d,g,f){g=z(g,f);f=E(d);for(var c=0<a?0:f-1;0<=c&&c<f;c+=a)if(g(d[c],c,d))return c;return-1}}function n(r,d,g){return function(f,c,b){var t=0,e=E(f);if("number"==typeof b)0<r?t=0<=b?b:Math.max(b+e,t):e=0<=b?Math.min(b+1,e):b+e+1;else if(g&&b&&e)return b=
g(f,c),f[b]===c?b:-1;if(c!==c)return b=d(s.call(f,t,e),a.isNaN),0<=b?b+t:-1;for(b=0<r?t:e-1;0<=b&&b<e;b+=r)if(f[b]===c)return b;return-1}}function p(r,d){var g=C.length,b=r.constructor,b=a.isFunction(b)&&b.prototype||f,c="constructor";for(a.has(r,c)&&!a.contains(d,c)&&d.push(c);g--;)c=C[g],c in r&&r[c]!==b[c]&&!a.contains(d,c)&&d.push(c)}var c=this,k=c._,e=Array.prototype,f=Object.prototype,l=e.push,s=e.slice,h=f.toString,w=f.hasOwnProperty,q=Array.isArray,v=Object.keys,A=Function.prototype.bind,
y=Object.create,u=function(){},a=function(r){if(r instanceof a)return r;if(!(this instanceof a))return new a(r);this._wrapped=r};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports._=a):c._=a;a.VERSION="1.8.3";var x=function(a,d,g){if(void 0===d)return a;switch(null==g?3:g){case 1:return function(g){return a.call(d,g)};case 2:return function(g,K){return a.call(d,g,K)};case 3:return function(g,K,b){return a.call(d,g,K,b)};case 4:return function(g,
K,b,c){return a.call(d,g,K,b,c)}}return function(){return a.apply(d,arguments)}},z=function(r,d,g){return null==r?a.identity:a.isFunction(r)?x(r,d,g):a.isObject(r)?a.matcher(r):a.property(r)};a.iteratee=function(a,d){return z(a,d,Infinity)};var D=function(a,d){return function(g){var b=arguments.length;if(2>b||null==g)return g;for(var c=1;c<b;c++)for(var f=arguments[c],e=a(f),t=e.length,h=0;h<t;h++){var l=e[h];d&&void 0!==g[l]||(g[l]=f[l])}return g}},G=function(r){if(!a.isObject(r))return{};if(y)return y(r);
u.prototype=r;r=new u;u.prototype=null;return r},H=function(a){return function(d){return null==d?void 0:d[a]}},N=Math.pow(2,53)-1,E=H("length"),B=function(a){a=E(a);return"number"==typeof a&&0<=a&&a<=N};a.each=a.forEach=function(r,d,g){d=x(d,g);var b;if(B(r))for(g=0,b=r.length;g<b;g++)d(r[g],g,r);else{var c=a.keys(r);g=0;for(b=c.length;g<b;g++)d(r[c[g]],c[g],r)}return r};a.map=a.collect=function(r,d,g){d=z(d,g);g=!B(r)&&a.keys(r);for(var b=(g||r).length,c=Array(b),f=0;f<b;f++){var e=g?g[f]:f;c[f]=
d(r[e],e,r)}return c};a.reduce=a.foldl=a.inject=b(1);a.reduceRight=a.foldr=b(-1);a.find=a.detect=function(r,d,g){d=B(r)?a.findIndex(r,d,g):a.findKey(r,d,g);if(void 0!==d&&-1!==d)return r[d]};a.filter=a.select=function(r,d,g){var b=[];d=z(d,g);a.each(r,function(a,r,g){d(a,r,g)&&b.push(a)});return b};a.reject=function(r,d,g){return a.filter(r,a.negate(z(d)),g)};a.every=a.all=function(r,d,g){d=z(d,g);g=!B(r)&&a.keys(r);for(var b=(g||r).length,c=0;c<b;c++){var f=g?g[c]:c;if(!d(r[f],f,r))return!1}return!0};
a.some=a.any=function(r,d,g){d=z(d,g);g=!B(r)&&a.keys(r);for(var b=(g||r).length,c=0;c<b;c++){var f=g?g[c]:c;if(d(r[f],f,r))return!0}return!1};a.contains=a.includes=a.include=function(r,d,g,b){B(r)||(r=a.values(r));if("number"!=typeof g||b)g=0;return 0<=a.indexOf(r,d,g)};a.invoke=function(r,d){var g=s.call(arguments,2),b=a.isFunction(d);return a.map(r,function(a){var r=b?d:a[d];return null==r?r:r.apply(a,g)})};a.pluck=function(r,d){return a.map(r,a.property(d))};a.where=function(r,d){return a.filter(r,
a.matcher(d))};a.findWhere=function(r,d){return a.find(r,a.matcher(d))};a.max=function(d,g,b){var c=-Infinity,f=-Infinity,e;if(null==g&&null!=d){d=B(d)?d:a.values(d);for(var t=0,h=d.length;t<h;t++)b=d[t],b>c&&(c=b)}else g=z(g,b),a.each(d,function(a,d,r){e=g(a,d,r);if(e>f||-Infinity===e&&-Infinity===c)c=a,f=e});return c};a.min=function(d,g,b){var c=Infinity,f=Infinity,e;if(null==g&&null!=d){d=B(d)?d:a.values(d);for(var t=0,h=d.length;t<h;t++)b=d[t],b<c&&(c=b)}else g=z(g,b),a.each(d,function(a,d,r){e=
g(a,d,r);if(e<f||Infinity===e&&Infinity===c)c=a,f=e});return c};a.shuffle=function(d){d=B(d)?d:a.values(d);for(var g=d.length,b=Array(g),c=0,f;c<g;c++)f=a.random(0,c),f!==c&&(b[c]=b[f]),b[f]=d[c];return b};a.sample=function(d,g,b){return null==g||b?(B(d)||(d=a.values(d)),d[a.random(d.length-1)]):a.shuffle(d).slice(0,Math.max(0,g))};a.sortBy=function(d,g,b){g=z(g,b);return a.pluck(a.map(d,function(a,d,r){return{value:a,index:d,criteria:g(a,d,r)}}).sort(function(a,d){var r=a.criteria,g=d.criteria;if(r!==
g){if(r>g||void 0===r)return 1;if(r<g||void 0===g)return-1}return a.index-d.index}),"value")};var J=function(d){return function(g,b,c){var f={};b=z(b,c);a.each(g,function(a,c){var e=b(a,c,g);d(f,a,e)});return f}};a.groupBy=J(function(d,g,b){a.has(d,b)?d[b].push(g):d[b]=[g]});a.indexBy=J(function(a,d,g){a[g]=d});a.countBy=J(function(d,g,b){a.has(d,b)?d[b]++:d[b]=1});a.toArray=function(d){return d?a.isArray(d)?s.call(d):B(d)?a.map(d,a.identity):a.values(d):[]};a.size=function(d){return null==d?0:B(d)?
d.length:a.keys(d).length};a.partition=function(d,g,b){g=z(g,b);var c=[],f=[];a.each(d,function(a,d,r){(g(a,d,r)?c:f).push(a)});return[c,f]};a.first=a.head=a.take=function(d,g,b){return null==d?void 0:null==g||b?d[0]:a.initial(d,d.length-g)};a.initial=function(a,d,g){return s.call(a,0,Math.max(0,a.length-(null==d||g?1:d)))};a.last=function(d,g,b){return null==d?void 0:null==g||b?d[d.length-1]:a.rest(d,Math.max(0,d.length-g))};a.rest=a.tail=a.drop=function(a,d,g){return s.call(a,null==d||g?1:d)};a.compact=
function(d){return a.filter(d,a.identity)};var I=function(d,g,b,c){var f=[],e=0;c=c||0;for(var t=E(d);c<t;c++){var h=d[c];if(B(h)&&(a.isArray(h)||a.isArguments(h))){g||(h=I(h,g,b));var l=0,q=h.length;for(f.length+=q;l<q;)f[e++]=h[l++]}else b||(f[e++]=h)}return f};a.flatten=function(a,d){return I(a,d,!1)};a.without=function(d){return a.difference(d,s.call(arguments,1))};a.uniq=a.unique=function(d,g,b,c){a.isBoolean(g)||(c=b,b=g,g=!1);null!=b&&(b=z(b,c));c=[];for(var f=[],e=0,t=E(d);e<t;e++){var h=
d[e],l=b?b(h,e,d):h;g?(e&&f===l||c.push(h),f=l):b?a.contains(f,l)||(f.push(l),c.push(h)):a.contains(c,h)||c.push(h)}return c};a.union=function(){return a.uniq(I(arguments,!0,!0))};a.intersection=function(d){for(var g=[],b=arguments.length,c=0,f=E(d);c<f;c++){var e=d[c];if(!a.contains(g,e)){for(var t=1;t<b&&a.contains(arguments[t],e);t++);t===b&&g.push(e)}}return g};a.difference=function(d){var g=I(arguments,!0,!0,1);return a.filter(d,function(d){return!a.contains(g,d)})};a.zip=function(){return a.unzip(arguments)};
a.unzip=function(d){for(var g=d&&a.max(d,E).length||0,b=Array(g),c=0;c<g;c++)b[c]=a.pluck(d,c);return b};a.object=function(a,d){for(var g={},b=0,c=E(a);b<c;b++)d?g[a[b]]=d[b]:g[a[b][0]]=a[b][1];return g};a.findIndex=m(1);a.findLastIndex=m(-1);a.sortedIndex=function(a,d,g,b){g=z(g,b,1);d=g(d);b=0;for(var c=E(a);b<c;){var f=Math.floor((b+c)/2);g(a[f])<d?b=f+1:c=f}return b};a.indexOf=n(1,a.findIndex,a.sortedIndex);a.lastIndexOf=n(-1,a.findLastIndex);a.range=function(a,d,g){null==d&&(d=a||0,a=0);g=g||
1;d=Math.max(Math.ceil((d-a)/g),0);for(var b=Array(d),c=0;c<d;c++,a+=g)b[c]=a;return b};var L=function(d,g,b,c,f){if(!(c instanceof g))return d.apply(b,f);g=G(d.prototype);d=d.apply(g,f);return a.isObject(d)?d:g};a.bind=function(d,g){if(A&&d.bind===A)return A.apply(d,s.call(arguments,1));if(!a.isFunction(d))throw new TypeError("Bind must be called on a function");var b=s.call(arguments,2),c=function(){return L(d,c,g,this,b.concat(s.call(arguments)))};return c};a.partial=function(d){var g=s.call(arguments,
1),b=function(){for(var c=0,f=g.length,e=Array(f),t=0;t<f;t++)e[t]=g[t]===a?arguments[c++]:g[t];for(;c<arguments.length;)e.push(arguments[c++]);return L(d,b,this,this,e)};return b};a.bindAll=function(d){var g,b=arguments.length,c;if(1>=b)throw Error("bindAll must be passed function names");for(g=1;g<b;g++)c=arguments[g],d[c]=a.bind(d[c],d);return d};a.memoize=function(d,g){var b=function(c){var f=b.cache,e=""+(g?g.apply(this,arguments):c);a.has(f,e)||(f[e]=d.apply(this,arguments));return f[e]};b.cache=
{};return b};a.delay=function(d,a){var g=s.call(arguments,2);return setTimeout(function(){return d.apply(null,g)},a)};a.defer=a.partial(a.delay,a,1);a.throttle=function(d,g,b){var c,f,e,t=null,h=0;b||(b={});var l=function(){h=!1===b.leading?0:a.now();t=null;e=d.apply(c,f);t||(c=f=null)};return function(){var q=a.now();h||!1!==b.leading||(h=q);var k=g-(q-h);c=this;f=arguments;0>=k||k>g?(t&&(clearTimeout(t),t=null),h=q,e=d.apply(c,f),t||(c=f=null)):t||!1===b.trailing||(t=setTimeout(l,k));return e}};
a.debounce=function(d,g,b){var c,f,e,t,h,l=function(){var q=a.now()-t;q<g&&0<=q?c=setTimeout(l,g-q):(c=null,b||(h=d.apply(e,f),c||(e=f=null)))};return function(){e=this;f=arguments;t=a.now();var q=b&&!c;c||(c=setTimeout(l,g));q&&(h=d.apply(e,f),e=f=null);return h}};a.wrap=function(d,g){return a.partial(g,d)};a.negate=function(d){return function(){return!d.apply(this,arguments)}};a.compose=function(){var d=arguments,a=d.length-1;return function(){for(var g=a,b=d[a].apply(this,arguments);g--;)b=d[g].call(this,
b);return b}};a.after=function(d,a){return function(){if(1>--d)return a.apply(this,arguments)}};a.before=function(d,a){var g;return function(){0<--d&&(g=a.apply(this,arguments));1>=d&&(a=null);return g}};a.once=a.partial(a.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),C="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" ");a.keys=function(d){if(!a.isObject(d))return[];if(v)return v(d);var g=[],b;for(b in d)a.has(d,b)&&g.push(b);M&&p(d,g);
return g};a.allKeys=function(d){if(!a.isObject(d))return[];var g=[],b;for(b in d)g.push(b);M&&p(d,g);return g};a.values=function(d){for(var g=a.keys(d),b=g.length,c=Array(b),f=0;f<b;f++)c[f]=d[g[f]];return c};a.mapObject=function(d,g,b){g=z(g,b);b=a.keys(d);for(var c=b.length,f={},e,t=0;t<c;t++)e=b[t],f[e]=g(d[e],e,d);return f};a.pairs=function(d){for(var g=a.keys(d),b=g.length,c=Array(b),f=0;f<b;f++)c[f]=[g[f],d[g[f]]];return c};a.invert=function(d){for(var g={},b=a.keys(d),c=0,f=b.length;c<f;c++)g[d[b[c]]]=
b[c];return g};a.functions=a.methods=function(d){var g=[],b;for(b in d)a.isFunction(d[b])&&g.push(b);return g.sort()};a.extend=D(a.allKeys);a.extendOwn=a.assign=D(a.keys);a.findKey=function(d,g,b){g=z(g,b);b=a.keys(d);for(var c,f=0,e=b.length;f<e;f++)if(c=b[f],g(d[c],c,d))return c};a.pick=function(d,g,b){var c={},f=d,e,t;if(null==f)return c;a.isFunction(g)?(t=a.allKeys(f),e=x(g,b)):(t=I(arguments,!1,!1,1),e=function(d,a,g){return a in g},f=Object(f));for(var h=0,l=t.length;h<l;h++){var q=t[h],k=f[q];
e(k,q,f)&&(c[q]=k)}return c};a.omit=function(d,g,b){if(a.isFunction(g))g=a.negate(g);else{var c=a.map(I(arguments,!1,!1,1),String);g=function(d,g){return!a.contains(c,g)}}return a.pick(d,g,b)};a.defaults=D(a.allKeys,!0);a.create=function(d,g){var b=G(d);g&&a.extendOwn(b,g);return b};a.clone=function(d){return a.isObject(d)?a.isArray(d)?d.slice():a.extend({},d):d};a.tap=function(d,a){a(d);return d};a.isMatch=function(d,g){var b=a.keys(g),c=b.length;if(null==d)return!c;for(var f=Object(d),e=0;e<c;e++){var t=
b[e];if(g[t]!==f[t]||!(t in f))return!1}return!0};var F=function(d,g,b,c){if(d===g)return 0!==d||1/d===1/g;if(null==d||null==g)return d===g;d instanceof a&&(d=d._wrapped);g instanceof a&&(g=g._wrapped);var f=h.call(d);if(f!==h.call(g))return!1;switch(f){case "[object RegExp]":case "[object String]":return""+d===""+g;case "[object Number]":return+d!==+d?+g!==+g:0===+d?1/+d===1/g:+d===+g;case "[object Date]":case "[object Boolean]":return+d===+g}f="[object Array]"===f;if(!f){if("object"!=typeof d||
"object"!=typeof g)return!1;var e=d.constructor,t=g.constructor;if(e!==t&&!(a.isFunction(e)&&e instanceof e&&a.isFunction(t)&&t instanceof t)&&"constructor"in d&&"constructor"in g)return!1}b=b||[];c=c||[];for(e=b.length;e--;)if(b[e]===d)return c[e]===g;b.push(d);c.push(g);if(f){e=d.length;if(e!==g.length)return!1;for(;e--;)if(!F(d[e],g[e],b,c))return!1}else{f=a.keys(d);e=f.length;if(a.keys(g).length!==e)return!1;for(;e--;)if(t=f[e],!a.has(g,t)||!F(d[t],g[t],b,c))return!1}b.pop();c.pop();return!0};
a.isEqual=function(d,a){return F(d,a)};a.isEmpty=function(d){return null==d?!0:B(d)&&(a.isArray(d)||a.isString(d)||a.isArguments(d))?0===d.length:0===a.keys(d).length};a.isElement=function(d){return!(!d||1!==d.nodeType)};a.isArray=q||function(d){return"[object Array]"===h.call(d)};a.isObject=function(d){var a=typeof d;return"function"===a||"object"===a&&!!d};a.each("Arguments Function String Number Date RegExp Error".split(" "),function(d){a["is"+d]=function(a){return h.call(a)==="[object "+d+"]"}});
a.isArguments(arguments)||(a.isArguments=function(d){return a.has(d,"callee")});"function"!=typeof/./&&"object"!=typeof Int8Array&&(a.isFunction=function(d){return"function"==typeof d||!1});a.isFinite=function(d){return isFinite(d)&&!isNaN(parseFloat(d))};a.isNaN=function(d){return a.isNumber(d)&&d!==+d};a.isBoolean=function(d){return!0===d||!1===d||"[object Boolean]"===h.call(d)};a.isNull=function(d){return null===d};a.isUndefined=function(d){return void 0===d};a.has=function(d,a){return null!=d&&
w.call(d,a)};a.noConflict=function(){c._=k;return this};a.identity=function(d){return d};a.constant=function(d){return function(){return d}};a.noop=function(){};a.property=H;a.propertyOf=function(d){return null==d?function(){}:function(a){return d[a]}};a.matcher=a.matches=function(d){d=a.extendOwn({},d);return function(g){return a.isMatch(g,d)}};a.times=function(d,a,g){var b=Array(Math.max(0,d));a=x(a,g,1);for(g=0;g<d;g++)b[g]=a(g);return b};a.random=function(d,a){null==a&&(a=d,d=0);return d+Math.floor(Math.random()*
(a-d+1))};a.now=Date.now||function(){return(new Date).getTime()};q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};D=a.invert(q);H=function(d){var g=function(a){return d[a]},b="(?:"+a.keys(d).join("|")+")",c=RegExp(b),f=RegExp(b,"g");return function(d){d=null==d?"":""+d;return c.test(d)?d.replace(f,g):d}};a.escape=H(q);a.unescape=H(D);a.result=function(d,g,b){g=null==d?void 0:d[g];void 0===g&&(g=b);return a.isFunction(g)?g.call(d):g};var d=0;a.uniqueId=function(a){var g=
++d+"";return a?a+g:g};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var g=/(.)^/,t={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(d){return"\\"+t[d]};a.template=function(d,b,c){!b&&c&&(b=c);b=a.defaults({},b,a.templateSettings);c=RegExp([(b.escape||g).source,(b.interpolate||g).source,(b.evaluate||g).source].join("|")+"|$","g");var f=0,e="__p+='";d.replace(c,function(a,g,b,
c,t){e+=d.slice(f,t).replace(P,Q);f=t+a.length;g?e+="'+\n((__t=("+g+"))==null?'':_.escape(__t))+\n'":b?e+="'+\n((__t=("+b+"))==null?'':__t)+\n'":c&&(e+="';\n"+c+"\n__p+='");return a});e+="';\n";b.variable||(e="with(obj||{}){\n"+e+"}\n");e="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";try{var t=new Function(b.variable||"obj","_",e)}catch(h){throw h.source=e,h;}c=function(d){return t.call(this,d,a)};c.source="function("+(b.variable||"obj")+
"){\n"+e+"}";return c};a.chain=function(d){d=a(d);d._chain=!0;return d};var O=function(d,g){return d._chain?a(g).chain():g};a.mixin=function(d){a.each(a.functions(d),function(g){var b=a[g]=d[g];a.prototype[g]=function(){var d=[this._wrapped];l.apply(d,arguments);return O(this,b.apply(a,d))}})};a.mixin(a);a.each("pop push reverse shift sort splice unshift".split(" "),function(d){var g=e[d];a.prototype[d]=function(){var a=this._wrapped;g.apply(a,arguments);"shift"!==d&&"splice"!==d||0!==a.length||delete a[0];
return O(this,a)}});a.each(["concat","join","slice"],function(d){var g=e[d];a.prototype[d]=function(){return O(this,g.apply(this._wrapped,arguments))}});a.prototype.value=function(){return this._wrapped};a.prototype.valueOf=a.prototype.toJSON=a.prototype.value;a.prototype.toString=function(){return""+this._wrapped};"function"===typeof define&&define.amd&&define("underscore",[],function(){return a})}).call(this);window._sv=_.noConflict();
(function(){var b=this,m=b.Backbone,n=[],p=n.push,c=n.slice,k=n.splice,e;e="undefined"!==typeof exports?exports:b.Backbone={};e.VERSION="1.0.0";var f=b._sv;f||"undefined"===typeof require||(f=require("underscore"));e.$=b.jQuery||b.Zepto||b.ender||b.$;e.noConflict=function(){b.Backbone=m;return this};e.emulateHTTP=!1;e.emulateJSON=!1;var l=e.Events={on:function(d,a,b){if(!h(this,"on",d,[a,b])||!a)return this;this._events||(this._events={});(this._events[d]||(this._events[d]=[])).push({callback:a,context:b,
ctx:b||this});return this},once:function(d,a,b){if(!h(this,"once",d,[a,b])||!a)return this;var c=this,e=f.once(function(){c.off(d,e);a.apply(this,arguments)});e._callback=a;return this.on(d,e,b)},off:function(d,a,b){var c,e,l,q,k,m,w,x;if(!this._events||!h(this,"off",d,[a,b]))return this;if(!d&&!a&&!b)return this._events={},this;q=d?[d]:f.keys(this._events);k=0;for(m=q.length;k<m;k++)if(d=q[k],l=this._events[d]){this._events[d]=c=[];if(a||b)for(w=0,x=l.length;w<x;w++)e=l[w],(a&&a!==e.callback&&a!==
e.callback._callback||b&&b!==e.context)&&c.push(e);c.length||delete this._events[d]}return this},trigger:function(d){if(!this._events)return this;var a=c.call(arguments,1);if(!h(this,"trigger",d,a))return this;var b=this._events[d],f=this._events.all;b&&w(b,a);f&&w(f,arguments);return this},stopListening:function(d,a,b){var c=this._listeners;if(!c)return this;var f=!a&&!b;"object"===typeof a&&(b=this);d&&((c={})[d._listenerId]=d);for(var e in c)c[e].off(a,b,this),f&&delete this._listeners[e];return this}},
s=/\s+/,h=function(d,a,b,c){if(!b)return!0;if("object"===typeof b){for(var f in b)d[a].apply(d,[f,b[f]].concat(c));return!1}if(s.test(b)){b=b.split(s);f=0;for(var e=b.length;f<e;f++)d[a].apply(d,[b[f]].concat(c));return!1}return!0},w=function(d,a){var b,c=-1,f=d.length,e=a[0],h=a[1],l=a[2];switch(a.length){case 0:for(;++c<f;)(b=d[c]).callback.call(b.ctx);break;case 1:for(;++c<f;)(b=d[c]).callback.call(b.ctx,e);break;case 2:for(;++c<f;)(b=d[c]).callback.call(b.ctx,e,h);break;case 3:for(;++c<f;)(b=
d[c]).callback.call(b.ctx,e,h,l);break;default:for(;++c<f;)(b=d[c]).callback.apply(b.ctx,a)}};f.each({listenTo:"on",listenToOnce:"once"},function(d,a){l[a]=function(a,g,b){var c=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=f.uniqueId("l"));c[e]=a;"object"===typeof g&&(b=this);a[d](g,b,this);return this}});l.bind=l.on;l.unbind=l.off;f.extend(e,l);var q=e.Model=function(d,a){var b,c=d||{};a||(a={});this.cid=f.uniqueId("c");this.attributes={};f.extend(this,f.pick(a,v));a.parse&&
(c=this.parse(c,a)||{});if(b=f.result(this,"defaults"))c=f.defaults({},c,b);this.set(c,a);this.changed={};this.initialize.apply(this,arguments)},v=["url","urlRoot","collection"];f.extend(q.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(d){return f.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(d){return this.attributes[d]},escape:function(d){return f.escape(this.get(d))},has:function(d){return null!=
this.get(d)},set:function(d,a,b){var c,e,h,l,q,k,m;if(null==d)return this;"object"===typeof d?(e=d,b=a):(e={})[d]=a;b||(b={});if(!this._validate(e,b))return!1;h=b.unset;l=b.silent;d=[];q=this._changing;this._changing=!0;q||(this._previousAttributes=f.clone(this.attributes),this.changed={});m=this.attributes;k=this._previousAttributes;this.idAttribute in e&&(this.id=e[this.idAttribute]);for(c in e)a=e[c],f.isEqual(m[c],a)||d.push(c),f.isEqual(k[c],a)?delete this.changed[c]:this.changed[c]=a,h?delete m[c]:
m[c]=a;if(!l)for(d.length&&(this._pending=!0),a=0,c=d.length;a<c;a++)this.trigger("change:"+d[a],this,m[d[a]],b);if(q)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,b);this._changing=this._pending=!1;return this},unset:function(d,a){return this.set(d,void 0,f.extend({},a,{unset:!0}))},clear:function(d){var a={},b;for(b in this.attributes)a[b]=void 0;return this.set(a,f.extend({},d,{unset:!0}))},hasChanged:function(d){return null==d?!f.isEmpty(this.changed):f.has(this.changed,
d)},changedAttributes:function(d){if(!d)return this.hasChanged()?f.clone(this.changed):!1;var a,b=!1,c=this._changing?this._previousAttributes:this.attributes,e;for(e in d)f.isEqual(c[e],a=d[e])||((b||(b={}))[e]=a);return b},previous:function(d){return null!=d&&this._previousAttributes?this._previousAttributes[d]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(d){d=d?f.clone(d):{};void 0===d.parse&&(d.parse=!0);var a=this,b=d.success;d.success=function(c){if(!a.set(a.parse(c,
d),d))return!1;b&&b(a,c,d);a.trigger("sync",a,c,d)};F(this,d);return this.sync("read",this,d)},save:function(d,a,b){var c,e=this.attributes;null==d||"object"===typeof d?(c=d,b=a):(c={})[d]=a;if(!(!c||b&&b.wait||this.set(c,b)))return!1;b=f.extend({validate:!0},b);if(!this._validate(c,b))return!1;c&&b.wait&&(this.attributes=f.extend({},e,c));void 0===b.parse&&(b.parse=!0);var h=this,l=b.success;b.success=function(d){h.attributes=e;var a=h.parse(d,b);b.wait&&(a=f.extend(c||{},a));if(f.isObject(a)&&!h.set(a,
b))return!1;l&&l(h,d,b);h.trigger("sync",h,d,b)};F(this,b);d=this.isNew()?"create":b.patch?"patch":"update";"patch"===d&&(b.attrs=c);d=this.sync(d,this,b);c&&b.wait&&(this.attributes=e);return d},destroy:function(d){d=d?f.clone(d):{};var a=this,b=d.success,c=function(){a.trigger("destroy",a,a.collection,d)};d.success=function(f){(d.wait||a.isNew())&&c();b&&b(a,f,d);a.isNew()||a.trigger("sync",a,f,d)};if(this.isNew())return d.success(),!1;F(this,d);var e=this.sync("delete",this,d);d.wait||c();return e},
url:function(){var d=f.result(this,"urlRoot")||f.result(this.collection,"url")||C();return this.isNew()?d:d+("/"===d.charAt(d.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(d,a){return d},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(d){return this._validate({},f.extend(d||{},{validate:!0}))},_validate:function(d,a){if(!a.validate||!this.validate)return!0;d=f.extend({},this.attributes,d);var b=this.validationError=
this.validate(d,a)||null;if(!b)return!0;this.trigger("invalid",this,b,f.extend(a||{},{validationError:b}));return!1}});f.each("keys values pairs invert pick omit".split(" "),function(d){q.prototype[d]=function(){var a=c.call(arguments);a.unshift(this.attributes);return f[d].apply(f,a)}});var A=e.Collection=function(d,a){a||(a={});a.url&&(this.url=a.url);a.model&&(this.model=a.model);void 0!==a.comparator&&(this.comparator=a.comparator);this._reset();this.initialize.apply(this,arguments);d&&this.reset(d,
f.extend({silent:!0},a))},y={add:!0,remove:!0,merge:!0},u={add:!0,merge:!1,remove:!1};f.extend(A.prototype,l,{model:q,initialize:function(){},toJSON:function(d){return this.map(function(a){return a.toJSON(d)})},sync:function(){return e.sync.apply(this,arguments)},add:function(d,a){return this.set(d,f.defaults(a||{},u))},remove:function(d,a){d=f.isArray(d)?d.slice():[d];a||(a={});var b,c,e,h;b=0;for(c=d.length;b<c;b++)if(h=this.get(d[b]))delete this._byId[h.id],delete this._byId[h.cid],e=this.indexOf(h),
this.models.splice(e,1),this.length--,a.silent||(a.index=e,h.trigger("remove",h,this,a)),this._removeReference(h);return this},set:function(d,a){a=f.defaults(a||{},y);a.parse&&(d=this.parse(d,a));f.isArray(d)||(d=d?[d]:[]);var b,c,e,h,l,q=a.at,m=this.comparator&&null==q&&!1!==a.sort,w=f.isString(this.comparator)?this.comparator:null,x=[],n=[],v={};b=0;for(c=d.length;b<c;b++)if(e=this._prepareModel(d[b],a))(h=this.get(e))?(a.remove&&(v[h.cid]=!0),a.merge&&(h.set(e.attributes,a),m&&!l&&h.hasChanged(w)&&
(l=!0))):a.add&&(x.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e));if(a.remove){b=0;for(c=this.length;b<c;++b)v[(e=this.models[b]).cid]||n.push(e);n.length&&this.remove(n,a)}x.length&&(m&&(l=!0),this.length+=x.length,null!=q?k.apply(this.models,[q,0].concat(x)):p.apply(this.models,x));l&&this.sort({silent:!0});if(a.silent)return this;b=0;for(c=x.length;b<c;b++)(e=x[b]).trigger("add",e,this,a);l&&this.trigger("sort",this,a);return this},reset:function(d,
a){a||(a={});for(var b=0,c=this.models.length;b<c;b++)this._removeReference(this.models[b]);a.previousModels=this.models;this._reset();this.add(d,f.extend({silent:!0},a));a.silent||this.trigger("reset",this,a);return this},push:function(d,a){d=this._prepareModel(d,a);this.add(d,f.extend({at:this.length},a));return d},pop:function(d){var a=this.at(this.length-1);this.remove(a,d);return a},unshift:function(d,a){d=this._prepareModel(d,a);this.add(d,f.extend({at:0},a));return d},shift:function(d){var a=
this.at(0);this.remove(a,d);return a},slice:function(d,a){return this.models.slice(d,a)},get:function(d){return null==d?void 0:this._byId[null!=d.id?d.id:d.cid||d]},at:function(d){return this.models[d]},where:function(d,a){return f.isEmpty(d)?a?void 0:[]:this[a?"find":"filter"](function(a){for(var b in d)if(d[b]!==a.get(b))return!1;return!0})},findWhere:function(d){return this.where(d,!0)},sort:function(d){if(!this.comparator)throw Error("Cannot sort a set without a comparator");d||(d={});f.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this));d.silent||this.trigger("sort",this,d);return this},sortedIndex:function(d,a,b){a||(a=this.comparator);var c=f.isFunction(a)?a:function(d){return d.get(a)};return f.sortedIndex(this.models,d,c,b)},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;a.success=function(e){c[a.reset?"reset":
"set"](e,a);b&&b(c,e,a);c.trigger("sync",c,e,a)};F(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?f.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,e=b.success;b.success=function(f){b.wait&&c.add(a,b);e&&e(a,f,b)};a.save(null,b);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof q)return a.collection||
(a.collection=this),a;b||(b={});b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,e){if("add"!==a&&"remove"!==a||c===this)"destroy"===a&&this.remove(b,e),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments)}});f.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){A.prototype[a]=function(){var b=c.call(arguments);b.unshift(this.models);return f[a].apply(f,b)}});f.each(["groupBy","countBy","sortBy"],function(a){A.prototype[a]=function(b,c){var e=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,e,c)}});var n=e.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},a=/^(\S+)\s*(.*)$/,x="model collection el id attributes className tagName events".split(" ");
f.extend(n.prototype,l,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof e.$?a:e.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(d){if(!d&&!(d=f.result(this,"events")))return this;this.undelegateEvents();for(var b in d){var c=d[b];f.isFunction(c)||
(c=this[d[b]]);if(c){var e=b.match(a),h=e[1],e=e[2],c=f.bind(c,this),h=h+(".delegateEvents"+this.cid);if(""===e)this.$el.on(h,c);else this.$el.on(h,e,c)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=f.extend({},f.result(this,"options"),a));f.extend(this,f.pick(a,x));this.options=a},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var a=f.extend({},f.result(this,"attributes"));
this.id&&(a.id=f.result(this,"id"));this.className&&(a["class"]=f.result(this,"className"));a=e.$("<"+f.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});e.sync=function(a,b,c){var h=z[a];f.defaults(c||(c={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var l={type:h,dataType:"json"};c.url||(l.url=f.result(b,"url")||C());null!=c.data||!b||"create"!==a&&"update"!==a&&"patch"!==a||(l.contentType="application/json",l.data=JSON.stringify(c.attrs||b.toJSON(c)));c.emulateJSON&&(l.contentType=
"application/x-www-form-urlencoded",l.data=l.data?{model:l.data}:{});if(c.emulateHTTP&&("PUT"===h||"DELETE"===h||"PATCH"===h)){l.type="POST";c.emulateJSON&&(l.data._method=h);var q=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",h);if(q)return q.apply(this,arguments)}}"GET"===l.type||c.emulateJSON||(l.processData=!1);"PATCH"!==l.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(l.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=c.xhr=e.ajax(f.extend(l,c));b.trigger("request",b,a,c);return a};var z={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var D=e.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},G=/\((.*?)\)/g,H=/(\(\?)?:\w+/g,N=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(D.prototype,l,{initialize:function(){},route:function(a,b,c){f.isRegExp(a)||(a=this._routeToRegExp(a));
f.isFunction(b)&&(c=b,b="");c||(c=this[b]);var h=this;e.history.route(a,function(f){f=h._extractParameters(a,f);c&&c.apply(h,f);h.trigger.apply(h,["route:"+b].concat(f));h.trigger("route",b,f);e.history.trigger("route",h,b,f)});return this},navigate:function(a,b){e.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(E,"\\$&").replace(G,
"(?:$1)?").replace(H,function(a,d){return d?a:"([^/]+)"}).replace(N,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var B=e.History=function(){this.handlers=[];f.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},J=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,L=/msie [\w.]+/,M=/\/$/;B.started=!1;f.extend(B.prototype,l,{interval:50,getHash:function(a){return(a=
(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(M,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(J,"")},start:function(a){if(B.started)throw Error("Backbone.history has already been started");B.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;
this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=document.documentMode,b=L.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(I,"/");b&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)e.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&
"onhashchange"in window&&!b)e.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=
this.getHash().replace(J,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);B.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;
this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!B.started)return!1;b&&!0!==b||(b={trigger:b});a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,
a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});e.history=new B;q.extend=A.extend=D.extend=n.extend=B.extend=function(a,b){var c=this,e;e=a&&f.has(a,"constructor")?a.constructor:function(){return c.apply(this,
arguments)};f.extend(e,c,b);var h=function(){this.constructor=e};h.prototype=c.prototype;e.prototype=new h;a&&f.extend(e.prototype,a);e.__super__=c.prototype;return e};var C=function(){throw Error('A "url" property or function must be specified');},F=function(a,b){var c=b.error;b.error=function(e){c&&c(a,e,b);a.trigger("error",a,e,b)}}}).call(this);window.SVBackbone=Backbone.noConflict();SVBackbone.$=$svjq;
(function(){function b(b,c,l){var k=window.sv.ErrorUtil;k&&k.handleBackboneError(b,c,l)}var m=window.SVBackbone,n=m.Model.prototype.fetch,p=m.Model.prototype.save,c=m.Model.prototype.destroy,k=m.Collection.prototype.fetch;m.Model.prototype.fetch=function(c){c=c||{};c.error=c.error||b;return n.apply(this,[c])};m.Model.prototype.save=function(c,f,l){null==c||"object"===typeof c?(f=f||{},f.error=f.error||b):(l=l||{},l.error=l.error||b);return p.apply(this,[c,f,l])};m.Model.prototype.destroy=function(e){e=
e||{};e.error=e.error||b;return c.apply(this,[e])};m.Collection.prototype.fetch=function(c){c=c||{};c.error=c.error||b;return k.apply(this,[c])}})();
(function(){var b=window.sv,m=b.ObjectUtil,n=b.Log,p=window.$svjq,c=window._sv,k=function(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(window.location.href))?b[1]:null},e=function(b,c,e){var f;f="string"===p.type(b)?p(b):b;p.get(c,function(b){f.fadeOut("fast",function(){f.html(b);f.fadeIn();p.isFunction(e)&&e.call(this)})})},f={};b.PortletUtil={getModelObjectUri:function(c,e,f){c="/modelobjectapi/1/"+b.PageContext.pageId+"/"+c+"/"+e;f&&(c+="/"+f);return c},getEditApiUri:function(c){var e=
c.modelHandler,f=c.objectId,k=c.operationObjectId,q=c.contextNodeId||b.PageContext.pageId;"string"===typeof c&&(e=c);f||(f=b.PageContext.pageId);c="/edit-api/1/"+q+"/"+f+"/"+e;k&&(c+="/"+k);return c},getPortletUri:function(c,f){return"/"+b.PageContext.pageId+"/"+c+".xml?state="+f},getPortletResourceUri:function(c,f){var e=k("identity"),m=k("group"),q=k("tag");return"/portletresource/"+b.PageContext.pageId+"/"+c+"?state="+f+(e?"&identity="+e:"")+(m?"&group="+m:"")+(q?"&tag="+q:"")},reloadPortletsByType:function(c,
f){var h=p(c);p.each(h,function(){var c=p(this),h=c.attr("id"),h=m.getObjectId(h);e(c,"/"+b.PageContext.pageId+"/"+h+".xml"+(f||""))})},doGetWithFade:e,doGet:function(b,c){p.get(c,function(c){p(b).html(c)})},getTemplate:function(b,e){var h=b.attr("id"),k;if(h){h=h.replace(".","_");if(!f[h+e]){k=b.find("script.sv-tmpl-"+e);if(0===k.length){n.warn("portletUtil","Could not find template with name "+e+" for portlet "+h);return}f[h+e]=c.template(k.html())}return f[h+e]}n.warn("portletUtil","Tried to get template from invalid element")}}})();
(function(){var b=window.$svjq,m=window.sv,n=m.KeyUtil,p=m.DialogUtil,c=m.PortletUtil,k=m.DateUtil,e=m.Events,f=window.moment,l=window.SVBackbone,s=b("html").hasClass("sv-touch"),h=function(a,b){return m.i18n.getText("common",a,b)},w,q=l.View.extend({template:function(){return c.getTemplate(this.options.$portlet,this.templateName)},memberTemplate:function(){return c.getTemplate(this.options.$portlet,this.memberTemplateName)},participantTemplate:function(){return c.getTemplate(this.options.$portlet,
this.participantTemplateName)},events:{"click [data-fn-allday]":"toggleTimeVisibility",'keyup [name="where"]':"showMapLink"},initialize:function(a){this.options=a;this.originalValues={};a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers);this.$el.append(a(c));this.listenTo(this.model,"invalid",this.handleErrors);this.ui={startDate:this.$el.find("[name=startDate]"),startTime:this.$el.find("[data-fn-time-value-start]"),endDate:this.$el.find("[name=endDate]"),endTime:this.$el.find("[data-fn-time-value-end]"),
allDay:this.$el.find("[name=allDay]"),isDone:this.$el.find("[name=isDone]"),owner:this.$el.find("#owner"),participants:this.$el.find("#participants")}},render:function(){var a=this,e=[{text:h("cancel"),callback:function(){b(".modal").modal("hide");a.restoreChanges()}}];this.model.isNew()?e.push({text:this.i18n("create"),skipDismiss:!0,primary:!0,callback:function(){a.saveChanges()}}):e.push({text:h("remove"),danger:!0,callback:b.proxy(this.removeActivity,this)},{text:h("ok"),skipDismiss:!0,primary:!0,
callback:function(){a.saveChanges()}});p.showDialog({title:this.model.attributes.isTask?this.i18n("task"):this.i18n("event"),body:this.$el,buttons:e,removeOnHide:!0,errorTitle:h("networkErrorTitle"),errorMsg:h("networkErrorText")});e={format:f.localeData()._longDateFormat.L.toLowerCase(),autoclose:!0};this.ui.startDate.bootstrapDatepicker(e).on("change",b.proxy(function(){var a=this.ui.endDate.val(),b=this.ui.startDate.bootstrapDatepicker("getDate");!a&&b&&this.ui.endDate.bootstrapDatepicker("setDate",
b)},this));this.ui.endDate.bootstrapDatepicker(e);var e=this.$el.parent().parent(),q={decimal:h("decimal"),mins:h("mins"),hr:h("hr"),hrs:h("hrs")},l=k.moment2PhpFormat(f.localeData()._longDateFormat.LT);this.ui.startTime.timepicker({timeFormat:l,lang:q,appendTo:e,scrollDefaultNow:!0}).on("timeFormatError",b.proxy(function(){var a=f();this.ui.startTime.val(a.format("LT"))},this)).on("change",b.proxy(function(){var a;!this.ui.endTime.val()&&this.ui.startTime.val()&&(a=f(this.ui.startTime.val(),"LT",
!0),a.add(2,"hours"),this.ui.endTime.val(a.format("LT")))},this));this.ui.endTime.timepicker({timeFormat:l,lang:q,appendTo:e}).on("timeFormatError",b.proxy(function(){var a=this.ui.startTime.val();a?(a=f(a,"LT",!0),a.add(2,"hours")):a=f();this.ui.endTime.val(a.format("LT"))},this));b.ajax({url:c.getPortletResourceUri(this.options.portletId,this.membersWithOwnerActionName)+(this.model.isNew()?"":"&id="+this.model.id)}).done(b.proxy(function(a){this.ui.owner.select2({allowClear:!0,data:a,formatResult:this.memberTemplate(),
escapeMarkup:function(a){return a}})},this));b.ajax({url:c.getPortletResourceUri(this.options.portletId,this.membersActionName)}).done(b.proxy(function(a){this.ui.participants.select2({multiple:!0,data:a,formatResult:this.memberTemplate(),formatSelection:this.participantTemplate(),escapeMarkup:function(a){return a}})},this))},handleErrors:function(a,b){A(a,b,this.$el,this.i18n)},templateHelpers:{mapUrl:function(a){return u(a)},datePickerValue:function(a){return f(a).isValid()?f(a).format("L"):""},
timePickerValue:function(a){return f(a).isValid()?"00:00"===f(a).format("LT")||"12:00 AM"===f(a).format("LT")?"":f(a).format("LT"):""}},showMapLink:function(a){this.typingTimer&&window.clearTimeout(this.typingTimer);this.typingTimer=window.setTimeout(b.proxy(function(){var c=u(a.currentTarget.value);if(!this.$mapLink&&(this.$mapLink=this.$el.find("[data-fn-map-link]"),!this.$mapLink.length)){var e='<span class="help-block"><i class="halflings-icon icon-map-marker"></i> <a data-fn-map-link class="sv-map-link" target="_blank" href="'+
c+'">'+this.i18n("map")+"</a></span>";this.$mapLink=b(e).insertAfter(a.currentTarget).find("[data-fn-map-link]")}a.currentTarget.value?this.$mapLink.closest(".help-block").show():this.$mapLink.closest(".help-block").hide();this.$mapLink.attr("href",c)},this),1E3)},toggleTimeVisibility:function(){this.ui.startTime.toggleClass("sv-hidden");this.ui.endTime.toggleClass("sv-hidden")},setAndSaveForRestore:function(a,b){this.originalValues[a]||(this.originalValues[a]=this.model.get(a));this.model.set(a,
b)},restoreChanges:function(){var a=this;b.each(this.originalValues,function(b,c){a.model.set(b,c)})},setAndSaveDateForRestore:function(a,b,c){b.length?(b=f(b,"L",!0),c=f(c,"LT",!0),b.hours(c.hours()).minutes(c.minutes()),this.setAndSaveForRestore(a,b.valueOf())):this.setAndSaveForRestore(a,"")},saveChanges:function(){var a=this;this.$el.find("[data-fn-standard-value]").each(function(){a.setAndSaveForRestore(this.name,b.trim(this.value))});var c=this.ui.allDay.prop("checked");this.setAndSaveForRestore("allDay",
c);var c=b.trim(this.ui.startDate.val()),f=b.trim(this.ui.startTime.val());this.setAndSaveDateForRestore("start",c,f);c=b.trim(this.ui.endDate.val());f=b.trim(this.ui.endTime.val());this.setAndSaveDateForRestore("end",c,f);c=this.ui.isDone.prop("checked");this.setAndSaveForRestore("isDone",c);var h=this.model.isNew();this.model.save(null,{wait:!0,success:function(c){a.backingModel.set(c.attributes);b(".modal").modal("hide");h?e.trigger(e.types.activityCreated,c.attributes):e.trigger(e.types.activityUpdated,
c.attributes)},error:function(){b(".alert").show()}})}}),v=l.View.extend({template:function(){return c.getTemplate(this.options.$portlet,this.templateName)},events:{"click [data-fn-more]":"more","click [data-fn-remove]":"removeActivity","click [data-fn-edit]":"editActivity","mouseenter [data-participants]":"showParticipants","mouseleave [data-participants]":"hideParticipants"},initialize:function(a){this.options=a;a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers());w=this.options.i18n;
this.$el.append(a(c));w=null;this.ui={description:this.$el.find("[data-fn-description]"),more:this.$el.find("[data-fn-more-remainder]"),participants:this.$el.find("[data-participants]")}},render:function(){var a=b("<div/>").text(this.model.get("title")).html(),c=y(this.options.$target);e.trigger(e.types.popoverCreated,this);this.options.$target.popover({html:!0,title:'<button type="button" class="close">&times;</button>'+a,placement:c,content:this.el,trigger:"manual",container:this.options.popoverContainer}).popover("show");
a=this.$el.closest(".popover");if(this.options.jsEvent){var f=this.options.jsEvent.pageY;if("top"===c)f-=a.height()+10;else if("left"===c||"right"===c)f-=a.height()/2;a.css({top:f})}a.on("click",".close",b.proxy(this.closePopover,this)).on("clickoutside",b.proxy(this.closePopover,this));b(document).on("keydown",b.proxy(this.closePopoverOnEscape,this));b("[data-fn-request-focus]").focus();e.on(e.types.popoverCreated,b.proxy(this.closePopoverWhenOtherIsCreated,this));return this},templateHelpers:function(){var a=
{maxSizeText:function(a){a=b("<div/>").text(a).html();if(150>a.length)return a;var c="<span>"+a.substring(0,150)+'</span><span data-fn-more class="sv-more">&nbsp;...'+w("more")+" &raquo;</span>";return c+='<span data-fn-more-remainder class="sv-hidden">'+a.substring(150)+"</span>"},mapUrl:function(a){return u(a)}};this.templateHelpers2&&(a=b.extend(a,this.templateHelpers2));return a},showParticipants:function(){var a=this.model.get("participants");a&&0<a.length&&(this.participants?this.showParticipantsTooltip():
b.ajax({url:c.getPortletResourceUri(this.options.portletId,this.participantsActionName)+"&id="+this.model.id}).done(b.proxy(function(a){this.participants=a;this.showParticipantsTooltip()},this)))},showParticipantsTooltip:function(){this.ui.participants.tooltip({html:!0,title:this.participants.join("<br/>")});this.ui.participants.tooltip("show")},hideParticipants:function(){this.ui.participants.tooltip("destroy")},more:function(a){b(a.currentTarget).addClass("sv-hidden");this.ui.description.css("max-height",
this.ui.description.height()+20+"px").addClass("sv-show-scroll");this.ui.more.removeClass("sv-hidden")},closePopover:function(){e.off(e.types.popoverCreated);b(document).off("keydown",this.closePopoverOnEscape);this.$el.closest(".popover").off("click",".close",this.closePopover).off("clickoutside",this.closePopover).remove();this.options.$target.popover("destroy")},editActivity:function(){this.model.fetch({success:b.proxy(function(a){this.createEditView(a).render();s&&b(window).scrollTop(0)},this)});
this.closePopover();return!1},closePopoverWhenOtherIsCreated:function(a){this!==a&&this.closePopover()},closePopoverOnEscape:function(a){if(a.keyCode===n.KEY.ESC)return this.closePopover(),!1}}),l=l.Model.extend({defaults:{title:"",description:"",where:"",owner:"",participants:"",start:"",end:""},initialize:function(a,b){this.portletId=b.portletId},validate:function(a){var b=[];a.title||b.push({field:"title",message:"noTitle"});a.owner||b.push({field:"owner",message:"noOwner"});if(!this.allowEmptyStart&&
!a.start)b.push({field:"start",message:"noStart"});else if(a.allDay||a.end)a.start||b.push({field:"start",message:"noStart"});if(a.start&&a.end){var c=f(a.start),e=f(a.end);a.allDay&&e.isSame(c)||e.isAfter(c)||b.push({field:"end",message:a.allDay?"invalidAllDayTimePeriod":"invalidTimePeriod"})}!a.allDay&&a.start&&(a.end||b.push({field:"end",message:"noEnd"}));return b.length?b:void 0}}),A=function(a,b,c,e){a=0;var f=b.length,h;for(c.find(".control-group").removeClass("error").find(".help-block.error").remove();a<
f;a++)h=b[a],c.find('[name="'+h.field+'"]').closest(".control-group").addClass("error").find(".controls").append('<span class="help-block error">'+e(h.message)+"</span>")},y=function(a){if(s)return"bottom";var c=a.offset().top-b(window).scrollTop(),e=window.innerHeight-c;a=a.offset().left-b(window).scrollLeft();return 220<=e?"bottom":220<=c?"top":a>=window.innerWidth-a?"left":"right"},u=function(a){return"https://maps.google.se/maps?hl="+m.PageContext.userLocale+"&q="+a+"&source=calendar"};f.locale(m.PageContext.userLocale);
m.ActivityUtil={showErrors:A,calculatePopoverPlacement:y,stripYear:function(a,b){var c=""+f(a).year();return b.replace(new RegExp(c,"g"),"").replace(/  /g," ")},ActivityModel:l,ActivityDetailView:v,ActivityEditView:q}})();
(function(){function b(b){for(var c=0,e=b.length,f=[],h;c<e;c++)h=b[c],f.push({key:h,value:s(h)});return f}function m(c){c.groupTypes=b(c.groupTypes);var e=n(w(c)),f=[{text:p.i18n.getText("common","cancel")},{text:p.i18n.getText("common","ok"),skipDismiss:!0,primary:!0,callback:function(){var b=p.PortletUtil.getPortletResourceUri(c.portletId,"groupAdministration");n.ajax({type:"POST",dataType:"JSON",data:n(".sv-fn-create-group-form").serialize(),url:b,success:function(b){n(".modal").modal("hide");
location.href=b.showGroupURL},error:function(b){n(".alert").show();b=n.parseJSON(b.responseText);var a=n(".alert").find(".alert-title");a.data("orginal-title",a.text());a=n(".alert").find(".alert-message");a.data("orginal-message",a.text());a.text(s(b.type.toLowerCase()));e.find("input").first().focus().closest(".control-group").addClass("error")}})}}];p.DialogUtil.showDialog({title:s("createGroupLabel"),body:e,buttons:f,removeOnHide:!0,errorTitle:s("createGroupError"),errorMsg:s("groupAlreadyExists")})}
var n=window.$svjq,p=window.sv,c=p.KeyUtil,k=c.KEY,e={},f,l=window._sv,s=function(b,c){var f;if(!c&&e[b])return e[b];f=p.i18n.getText("portlet.util.addgrouputil",b,c);c||(e[b]=f);return f},h={success:function(){},selected:function(){},placeholder:"",groupTemplates:[],groupFolder:null,hitTemplate:l.template('<li data-group-id="<%= id %>" class="sv-clearfix <% if (isMember) { %> sv-group-member<% } %>">   <img class="sv-group-img sv-buddy-icon" src="<%= iconURL %>" />   <% if (isMember) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-group-info-container">     <h3 class="sv-group-name"><%- name %></h3>     <p>        <%= memberCount %> medlemmar     </p>   </div></li>')},
w=l.template('<form class="form-horizontal sv-fn-create-group-form">    <div class="control-group">       <label class="control-label">'+s("name")+'</label>       <div class="controls">          <input class="input-xlarge" data-fn-groupname type="text" name="name" required value="<%= name %>" />          <span class="help-block help">'+s("nameHelp")+'</span>       </div>    </div>    <div class="control-group">       <label class="control-label">'+s("description")+'</label>       <div class="controls">          <textarea class="input-xlarge" data-fn-groupdescription data-fn-request-focus rows="3" type="text" name="description"></textarea>          <span class="help-block help">'+
s("descriptionHelp")+'</span>       </div>    </div>    <% if (templates.length > 1) { %>    <div class="control-group">       <label class="control-label">'+s("template")+'</label>       <div class="controls">          <select name="template">            <% for(var idx in templates) { %>               <option value="<%= templates[idx].id %>"><%= templates[idx].name %></option>            <% } %>          </select>          <span class="help-block help">'+s("templateHelp")+'</span>       </div>    </div>    <% } else { %>    <input type="hidden" name="template" value="<%= templates[0].id %>">    <% } %>    <div class="control-group">       <label class="control-label">'+
s("type")+'</label>       <div class="controls">          <select name="type">            <% for(var idx in groupTypes) { %>               <option value="<%= groupTypes[idx].key %>"><%= groupTypes[idx].value %></option>            <% } %>          </select>          <span class="help-block help">'+s("typeHelp")+"</span>       </div>    </div> </form>");p.AddGroupUtil={showSearchPopover:function(b){var e=n.extend({},h,b),l=n(e.target),w=0;if(l.hasClass("sv-fn-popover-showing"))l.popover("destroy").removeClass("sv-fn-popover-showing");
else{b='<form class="form-search" onsubmit="return false;"><input type="text" placeholder="'+(e.placeholder||"")+'" data-fn-group-search class="span2 search-query"/></form>';e.groupFolder&&(b='<form class="form-search" onsubmit="return false;"><div class="input-append"><input type="text" placeholder="'+(e.placeholder||"")+'" data-fn-group-search class="span1 search-query"/><button type="button" class="btn btn-small sv-fn-create-group">'+s("createGroup")+"</button></div></form>");l.popover("destroy").addClass("sv-fn-popover-showing").popover({html:!0,
title:b,placement:"bottom",content:'<ul class="sv-group-search-list sv-defaultlist"></ul>',trigger:"manual"});l.popover("show");var u=function(a){n(a.target).is(".popover *")||(l.popover("destroy").removeClass("sv-fn-popover-showing"),n("body").unbind("click",u))};n("body").bind("click",u);l.parent().find("[data-fn-group-search]").focus().closest(".popover").addClass("sv-groupsearch-popover");l.parent().find(".popover").on("click",".sv-fn-create-group",function(){m({name:l.parent().find("[data-fn-group-search]").val(),
folder:e.groupFolder,templates:e.groupTemplates,groupTypes:e.groupTypes,portletId:e.portletId})});var a=l.parent().find(".popover-content").find("ul"),x=[];l.parent().find("[data-fn-group-search]").keydown(function(b){b=c.getKeyCodeFromEvent(b);if(b===k.DOWN)return w++,w>x.length-1&&(w=0),a.children().removeClass("active").eq(w).addClass("active"),!1;if(b===k.UP)return w--,0>w&&(w=x.length-1),a.children().removeClass("active").eq(w).addClass("active"),!1}).keyup(function(b){b=c.getKeyCodeFromEvent(b);
if(b===k.ESC)return l.popover("destroy"),!1;if(b===k.RETURN){if("undefined"!==typeof x[w])return l.popover("destroy"),e.selected&&e.selected.call(this,x[w]),!1;-1===w&&m({name:n(this).val(),folder:e.groupFolder,template:e.groupTemplate,groupTypes:e.groupTypes,portletId:e.portletId})}else{if(c.isNonTextModifiableKeyCode(b))return!1;var h=this;f&&clearTimeout(f);f=setTimeout(function(){w=-1;a.empty();var b=n(h).val();n.ajax({url:p.PortletUtil.getModelObjectUri(p.PageContext.pageId,"groupSearch",p.PageContext.pageId),
data:{term:b},dataType:"json"}).done(function(b){b.queryString===n(h).val()&&(w=0,a.empty(),x=b.hits,n.each(x,function(b,c){var f=n(e.hitTemplate(c));a.append(f);f.click(function(){l.popover("destroy");e.selected&&e.selected.call(this,c);return!1}).mouseenter(function(){a.children().removeClass("active");w=b;n(this).addClass("active")})}),e.success&&e.success.call(this,x))})},200)}})}}}})();
window.$svjq(function(){function b(b){f=window.setTimeout(function(){if(k&&0<l.length){var b=l[l.length-1];l=["0"];n.ajax({method:"PUT",url:"/modelobjectapi/1/"+c.pageId+"/"+c.pageId+"/groupViewed/"+c.pageId,data:JSON.stringify({uuid:b})}).success(function(){p.trigger(p.types.groupPageViewed)}).fail(function(b){switch(b.status){case 401:case 403:k=!1}})}f=void 0},b||e)}var m=window.sv,n=window.$svjq,p=m.Events,c=m.PageContext,k=!0,e=1E3*c.userIdentityReadTimeout,f,l=["0"];c&&c.pageId&&c.pageId.match("^704\\.")&&
(b(),p.on("server-group-updated-"+c.pageId,function(c){l.push(c.uuid);f?window.setTimeout(function(){window.clearTimeout(f);b(e/2)},e/2):b()}))});
(function(){var b=window.$svjq,m=window.sv,n=m.Log,p=m.Events,c=window._sv.template('<i class="halflings-icon thumbs-up"></i><b><%= likeText %></b> (<%= likeCount %>)'),k={},e=function(b){return k[b]?k[b]:m.i18n.getText("portlet.util.likableutil",b)},f=function(b){var f=b.data("like-count")||0,h=!!b.data("user-likes");b.html(c({likeText:h?e("likes"):e("like"),likeCount:f,userLikes:h}));b[h?"addClass":"removeClass"]("sv-liked")},l=function(c){c=c||b("body");c.is("[data-fn-likable],[data-fn-portlet-likable]")?
f(c):c.find("[data-fn-likable],[data-fn-portlet-likable]").each(function(){f(b(this))})},s=function(b,c){b.tooltip({html:!0,title:c.join("<br/>")});b.tooltip("show")},h=function(){var c=b(this),e=!!c.data("user-likes"),h=c.data("likable-id"),l;c.removeData("likes");c.tooltip("destroy");if(!h)n.warn("Trying to like object without likable-id in portlet "+c.closest(".sv-portlet").attr("id"));else if(!c.hasClass("sv-disabled"))return c.addClass("sv-disabled"),l=c.closest(".sv-portlet"),l=m.ObjectUtil.getObjectId(l.attr("id")),
l=e?m.PortletUtil.getPortletResourceUri(l,"unlike")+"&likable="+h:m.PortletUtil.getPortletResourceUri(l,"like"),b.ajax({url:l,method:e?"DELETE":"POST",dataType:"JSON",data:{likable:h}}).done(function(b){c.data("user-likes",!e).data("like-count",b.count);f(c)}).fail(function(b){m.ErrorUtil.handleAjaxFailure(b)}).always(function(){c.removeClass("sv-disabled")}),!1};m.LikableUtil={toggleLike:h};b("body").on("click.likeable","a[data-fn-likable]",h);b(document).on("mouseenter",".sv-like",function(){var c=
b(this),e=c.closest(".sv-portlet"),e=m.ObjectUtil.getObjectId(e.attr("id")),f=c.data("likable-id"),h=c.data("likes");0<c.data("like-count")&&(h?s(c,h):(e=m.PortletUtil.getPortletResourceUri(e,"likes")+"&likable="+f,b.ajax({url:e,method:"GET",dataType:"JSON"}).done(function(b){c.data("likes",b);s(c,b)}).fail(function(b){m.ErrorUtil.handleAjaxFailure(b)})))});b(document).on("mouseleave",".sv-like",function(){b(this).tooltip("destroy")});p.on(p.types.updateLikables,l);l()})();
(function(){var b=window.sv,m=window.$svjq,n=b.Events,p={includeHandle:!1,ajaxOptions:{timeout:5E3}},c=function(b){return/wikipedia.org|facebook.com\/groups/.test(b)};n.on(n.types.updateOembedLinks,function(k,e){function f(b){var c=document.createElement("a");c.href=b;b=c.hostname.split(".");c=b.length;b=1<c?b[c-2]:void 0;return b&&-1<n.indexOf(b)}function l(b){if("IFRAME"===b.prop("tagName")&&f(b[0].src))return m('<div class="sv-iframeEmbed-16_9" />').append(b);if(b.find("iframe").length&&f(b.find("iframe")[0].src))return b.find("iframe").wrap('<div class="sv-iframeEmbed-16_9" />'),
b;if(b.hasClass("fb-post"))return b.attr("data-width","auto"),b}if(k&&k.length&&(!k.hasClass("sv-embedded")||k.hasClass("sv-embeddedmedia-portlet"))){var n="youtube vimeo wistia bambuser streamio dreambroker".split(" "),h=k.find("a.sv-embed").first();if(h.length&&!c(h.attr("href"))){p.onEmbed=function(b){if(b&&b.code){b=b.code;if("string"===typeof b)try{b=m(b)}catch(c){return}if(b instanceof m){var e=l(b),f=!!e;b=f?e:b;if(1!==b.length||!b.is(":empty")){var e=this.closest(".sv-message-content"),e=
0<e.length?e.first():this.parent(),h=m("<a>",{href:this.attr("href"),target:"_blank"}),a=!f,f=m(f?'<div class="oembedall-container no-max-height"></div>':'<div class="oembedall-container"></div>');b.find("p").each(function(){var a=m(this),b=a.text();b&&200<b.length&&a.text(b.substring(0,190)+"...")});try{a?b.clone().wrap(h).parent().appendTo(f):b.clone().appendTo(f)}catch(k){a?f.append(b.wrap(h).parent()):f.append(b)}p.replace?this.replaceWith(f):e.after(f)}}}};p=m.extend(p,e);try{h.oembed(null,p),
k.addClass("sv-embedded")}catch(w){b.Log.error("oembedutil","Could not embed link. Error: "+w.message)}}}})})();(function(){var b=window.$svjq,m=window.moment,n=window.sv.Events,p=b("html").attr("lang")||"en",c=function(c){c=c||b("body");c.find("time[data-fn-relative-date]").each(function(){var c=b(this),f=c.attr("datetime"),l=c.data("short");m.locale(l?p+"-short":p);if(f=m(f))c.text(f.fromNow()),c.attr("title",f.format("LLLL"))})};window.setInterval(c,6E4);n.on(n.types.updateRelativeDates,c);c()})();
(function(){var b=window.$svjq,m=window.sv,n=m.PortletUtil,p=m.KeyUtil,c=p.KEY,k={},e,f=window._sv,l={success:function(){},selected:function(){},placeholder:"",markAdmins:!1,hitTemplate:f.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isMember) !== \'undefined\' && isMember) || (typeof(isAdmin) !== \'undefined\' && isAdmin) || (typeof(isContact) !== \'undefined\' && isContact)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>'),
adminHitTemplate:f.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isAdmin) !== \'undefined\' && isAdmin)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>')},s=
function(b,c){var e;if(!c&&k[b])return k[b];e=m.i18n.getText("portlet.util.searchuserutil",b,c);c||(k[b]=e);return e};m.SearchUserUtil={showSearchPopover:function(f){var k=b.extend({},l,f),q=b(k.target),v=0;if(q.hasClass("sv-fn-popover-showing"))b(".popover").remove(),q.removeClass("sv-fn-popover-showing");else{b(".popover").remove();q.addClass("sv-fn-popover-showing").popover({html:!0,container:0<q.closest(".modal").length?q.closest(".modal"):!1,title:'<input type="text" placeholder="'+(k.placeholder||
"")+'" data-fn-user-search class="input-medium search-query"/>',placement:"bottom",content:'<ul class="sv-user-search-list sv-defaultlist"></ul>',trigger:"manual"});q.popover("show");var A=function(a){b(a.target).is(".popover *")||(b(".popover").remove(),q.removeClass("sv-fn-popover-showing"),b("body").unbind("click",A))};b("body").bind("click",A);b("[data-fn-user-search]").focus().closest(".popover").addClass("sv-usersearch-popover");var y=n.getModelObjectUri(m.PageContext.pageId,"userIdentitySearch",
m.PageContext.pageId)+"?userfields=true",u=b(".popover-content").find("ul"),a=[];k.group&&(y+="&group="+k.group);k.userIdentity&&(y+="&identity="+k.identity);u.css("max-height",window.innerHeight-u.offset().top-10+"px");b("[data-fn-user-search]").keydown(function(b){b=p.getKeyCodeFromEvent(b);if(b===c.DOWN){v++;if(k.searchUrl&&v>a.length||!k.searchUrl&&v>a.length-1)v=0;u.children().removeClass("active").eq(v).addClass("active");return!1}if(b===c.UP)return v--,0>v&&(v=k.searchUrl?a.length:a.length-
1),u.children().removeClass("active").eq(v).addClass("active"),!1}).keyup(function(f){f=p.getKeyCodeFromEvent(f);if(f===c.ESC)return b(".popover").remove(),q.removeClass("sv-fn-popover-showing"),!1;if(f===c.RETURN){if(v===a.length)return 0<v&&"undefined"!==typeof u.children().eq(v).find("a").attr("href")?location.href=u.children().eq(v).find("a").attr("href"):""!==b(this).val()&&(location.href=k.searchUrl+"&query="+b(this).val()),!1;if("undefined"!==typeof a[v])return b(".popover").remove(),q.removeClass("sv-fn-popover-showing"),
k.selected&&k.selected.call(this,a[v]),!1}else{if(p.isNonTextModifiableKeyCode(f))return!1;var h=this;e&&clearTimeout(e);e=setTimeout(function(){v=0;u.empty();var c=b(h).val();""!==c&&b.ajax({url:y,dataType:"json",data:{term:c}}).done(function(e){e.queryString===b(h).val()&&(v=0,u.empty(),a=e.hits,b.each(a,function(a,c){var e=k.markAdmins?b(k.adminHitTemplate(c)):b(k.hitTemplate(c));u.append(e);e.click(function(){b(".popover").remove();q.removeClass("sv-fn-popover-showing");k.selected&&k.selected.call(this,
c);return!1}).mouseenter(function(){u.children().removeClass("active");v=a;b(this).addClass("active")})}),k.searchUrl&&0<a.length&&(e=s("showAll"),10>a.length&&(e=s("showAsList")),b('<li class="sv-showmore"><a href="'+k.searchUrl+"&query="+c+'">'+e+"</a></li>").appendTo(u).mouseenter(function(){u.children().removeClass("active");v=a.length}).click(function(){location.href=b(this).find("a").attr("href");return!1}),v=a.length),u.children().eq(v).addClass("active"),k.success&&k.success.call(this,a))})},
200)}})}}}})();
(function(){function b(b,c){var e;if(!c&&l[b])return l[b];e=n.i18n.getText("portlet.util.userinformation",b,c);c||(l[b]=e);return e}function m(b){var l=b.data("user-identity"),k=b.data("fn-show-user-popup-subtitle"),k=c.escape(b.attr("title"))+(k?"<small> "+c.escape(k)+"</small>":""),l=e.getModelObjectUri(n.PageContext.pageId,"userStatus",l);b.addClass("user-popover-loaded").webuiPopover({trigger:"hover",delay:300,type:"async",title:k,placement:"auto",url:l,content:function(b){b=JSON.parse(b);f.extend(b,
{showAddContact:b.userIdentityAvailable&&b.requestedUserIdentityAvailable,showSendMessage:b.userIdentityAvailable&&b.requestedUserIdentityAvailable&&0<f(".sv-messages-portlet").length});return(new h({model:new s(b)})).getContent()}})}var n=window.sv,p=window.SVBackbone,c=window._sv,k=n.Events,e=n.PortletUtil,f=window.$svjq,l={},s=p.Model.extend({defaults:{fields:[],contacts:0,groups:0,showSendMessage:!1},url:function(){return e.getModelObjectUri(n.PageContext.pageId,"userStatus",this.id)}}),h=p.View.extend({tagName:"div",
className:"bootstrap",template:c.template('<div class="bootstrap"><img style="float:left; margin-right:8px;" class="sv-buddy-icon" src="<%= largeBuddyIcon %>" /><div style="overflow: hidden" class="sv-userfields">    <% _.each(fields, function(field) { %>       <%- field %><br/>    <% }); %></div><div style="clear:left; padding-top:10px; margin-bottom:3px" class="sv-clearfix">    <div style="float:left;margin-top: 7px;"><img src="/sitevision/core/<%= status %>.png"/></div>       <div style="float:left;margin-top: 4px;"><small><%= statusText %></small></div>       <div style="float:right;padding-left: 10px;">         <% if (showAddContact && contact === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-default sv-add-contact">'+
b("addAsContact")+'</button>         <% } %>         <% if (showSendMessage && self === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-primary sv-send-message"><i class="halflings-icon comments white"></i> '+b("message")+"</button>         <% } %>       </div>    </div></div>"),getContent:function(){return this.template(this.model.toJSON())}});f("body").on("mouseenter","[data-user-identity][data-fn-show-user-popup]",function(){var b=f(this);b.hasClass("user-popover-loaded")||
(m(b),b.trigger("mouseenter"))});f("body").on("click","button.sv-send-message[data-user-identity]",function(){var b=f(this);k.trigger("sendMessage",b.data("user-identity"));b.closest("[data-user-identity][data-fn-show-user-popup]").webuiPopover("hide");return!1});f("body").on("click","button.sv-add-contact[data-user-identity]",function(){var b=f(this);f.post(e.getModelObjectUri(n.PageContext.userIdentityId,"addContact"),{id:b.data("user-identity")});f('[data-user-identity="'+b.data("user-identity")+
'"][data-fn-show-user-popup]').removeClass("user-popover-loaded").webuiPopover("destroy");return!1})})();
(function(){function b(b){b=b.serializeArray();var e={};c.each(b,function(b,c){e[c.name]=c.value});return e}var m=window.sv,n=m.PortletUtil,p=m.DialogUtil,c=window.$svjq,k=function(b){return m.i18n.getText("portlet.social.userfields.userfields",b)},e=function(b){return m.i18n.getText("common",b)},f=function(b){var c=!0;"function"===typeof b.checkValidity&&(c=b.checkValidity());return c};m.UserSettingsUtil={popupUserSettingsDialog:function(l){var s=c("<div/>").addClass("sv-userfields-content"),h=c("<form/>").addClass("form-horizontal sv-userfields-form");
s.append(h);c.ajax({type:"GET",dataType:"json",url:n.getModelObjectUri(m.PageContext.userIdentityId,"userfields",m.PageContext.userIdentityId),data:{fields:l||"all"},success:function(l){c.each(l.fields,function(b,e){var f=c("<div/>").addClass("control-group");h.append(f);var a=c("<label/>").addClass("control-label").text(e.name);f.append(a);a=c("<div/>").addClass("controls");f.append(a);"true"===e.writeable?"text_field"===e.type?(f=c("<textarea/>").attr({rows:"3",id:e.id,name:e.id,"data-errorMsg":e.validationErrorMessage}).addClass("input-xlarge"),
"no_validation"!==e.validationType&&("reg_exp_validation"===e.validationType&&e.regularExpression&&f.attr("pattern",e.regularExpression),e.value&&f.attr("required",""),f.attr("data-validation","true")),a.append(f),e.value&&f.val(e.value)):(f=c("<input/>").attr({type:e.type,id:e.id,name:e.id,"data-errorMsg":e.validationErrorMessage}).addClass("input-xlarge"),"no_validation"!==e.validationType&&("reg_exp_validation"===e.validationType&&e.regularExpression&&f.attr("pattern",e.regularExpression),e.value&&
f.attr("required",""),f.attr("data-validation","true")),a.append(f),e.value&&f.val(e.value),e.description&&(f=c("<span/>").addClass("help-block help").text(e.description),a.append(f))):e.value&&a.append(c("<label/>").attr({title:e.description}).css("padding-top","5px").text(e.value))});if(l.passwordRequired){var q=c("<div/>").addClass("control-group").addClass("well");h.append(q);var v=c("<label/>").addClass("control-label").text(k("password_field_title"));q.append(v);v=c("<div/>").addClass("controls");
q.append(v);q=c("<input/>").attr({id:"password",name:"password",type:"password"}).addClass("input-xlarge");v.append(q);q=c("<span/>").addClass("help-block help").text(k("password_field_description"));v.append(q)}h.find("input").not('[type="password"]').on("keyup",function(b){b=c(b.target);b.val().length&&b.attr("data-validation")?b.attr("required","required"):b.removeAttr("required")});v=[{text:e("cancel")},{text:e("ok"),skipDismiss:!0,primary:!0,callback:function(){c(".help-block").remove(".error");
c(".help-block").remove(".serverside-error");c(".control-group").removeClass("error");c(".alert").hide();if(f(h.get(0))){var p=b(h);c.ajax({type:"PUT",dataType:"JSON",url:n.getModelObjectUri(m.PageContext.userIdentityId,"userfields",m.PageContext.userIdentityId),data:JSON.stringify(p),processData:!1,success:function(b){if(b.success)n.reloadPortletsByType(".sv-userfields-portlet"),n.reloadPortletsByType(".sv-profileprogress-portlet"),c(".modal").modal("hide");else if(b.serverError){var a=c(".alert");
a.show();a.find(".alert-title").text(e("error"));a.find(".alert-message").text(k(b.serverError));"wrong_password"===b.serverError&&(b=s.find("#password"),b.parents(".control-group").addClass("error"),b.focus())}else c.each(b.failedFields,function(a,b){var e=c("#"+b);e.parents(".control-group").addClass("error");e.nextAll(".serverside-error").length||(e.nextAll(".help-block.error").remove(),e.after(c("<span/>").addClass("help-block help serverside-error").text(e.attr("data-errorMsg"))))})},error:function(){c(".alert").show()}})}else{var q=
c("#password");q.length&&!f(q.get(0))&&(q.get(0).focus(),q.parents(".control-group").addClass("error"),c(".alert").show(),c(".alert").find(".alert-title").text(e("error")),c(".alert").find(".alert-message").text(k("wrong_password")));c.each(l.fields,function(b,a){q=c("#"+a.id);"true"!==a.writeable||f(q.get(0))||(q.get(0).focus(),q.parents(".control-group").addClass("error"),q.nextAll(".serverside-error, .error").length||q.after(c("<span/>").addClass("help-block help error").text(q.attr("data-errorMsg"))))})}}}];
p.showDialog({title:k("dialogTitle"),body:s,buttons:v,removeOnHide:!0,errorTitle:k("errorTitle"),errorMsg:k("errorMsg")})}})}}})();
(function(){var b=window.$svjq,m=window.sv.Events,n=window.LazyLoad,p,c=function(b){p?b.call():(n.css("/sitevision/ajax/jquery/plugins/videojs/video-js.css"),n.js("/sitevision/ajax/jquery/plugins/videojs/video.js",function(){p=!0;window.videojs.options.flash.swf="/sitevision/ajax/jquery/plugins/videojs/video-js.swf";b.call()}))},k=function(e){e=e||b(".sv-timeline-portlet, .sv-video-portlet, .sv-timelineentry-portlet");e.find("video:not(.sv-video-js-loaded)").each(function(){var e=b(this);c(function(){e.addClass("sv-video-js-loaded");
window.videojs(e.get(0),{width:"auto",height:"auto"})})})};m.on(m.types.updateVideoLinks,k);k()})();(function(){window.sv.WindowLocationUtil={setHashValue:function(b,m){window.location.hash="#"+b+"/"+m},getHashValue:function(b){var m=window.location.hash,n=2+b.length;if(0===m.indexOf("#"+b+"/")&&m.length>n)return m.substring(n)},clearHashValue:function(){window.location.hash=""},hasHashValue:function(){var b=window.location.hash;return 0===b.indexOf("#")&&1<b.indexOf("/")},reloadPage:function(){location.reload()}}})();
(function(){var b=window.$svjq,m=window.sv.i18n,n=window.sv,p=n.PortletUtil,c=n.Ajax;b(".sv-archive-portlet").on("click",".sv-create-article-entry",function(){var k=b(this),e=k.data("archive-id"),f=k.data("template-id"),k=k.parent(),l=b("<div>").addClass("sv-loading-icon").text(m.getText("portlet.archive.archive","creatingArticle"));k.empty().append(l);c.doPost({url:p.getEditApiUri({objectId:e,contextNodeId:e,modelHandler:"article"}),data:{template:f,portletType:"archive"},success:function(b){window.location.href=
"/edit/"+b.nodeId}});return!1})})();
(function(){var b=window.$svjq,m=window.sv.i18n,n=window.sv,p=n.PortletUtil,c=n.Ajax;b(".sv-blog-portlet").on("click",".sv-create-blog-entry",function(){var k=b(this),e=k.data("archive-id"),f=k.data("template-id"),k=k.parent(),l=b("<div>").addClass("sv-loading-icon").text(m.getText("portlet.blog.blog","creatingBlogEntry"));k.empty().append(l);c.doPost({url:p.getEditApiUri({objectId:e,contextNodeId:e,modelHandler:"article"}),data:{template:f,portletType:"blog"},success:function(b){window.location.href=
"/edit/"+b.nodeId}});return!1})})();
(function(){function b(b){var e=b.find("[data-comments2-entry]");m(b);if(0!==e.length){var f=c.getObjectId(b.attr("id")),h=e.data("js-namespace"),k=e.data("profilepageurl"),e=e.data("tagresultpageurl"),q=new D(n[h].comments||[],{id:f,portletId:f});v=n[h].maxCharacterCount;A=n[h].useCaptcha;new H({el:b,collection:q,commentTemplate:p.getTemplate(b,"comments2-comment"),portletId:f,profilePageURL:k,tagResultPageURL:e});f=b.find(".sv-comments2-comments");0<f.length&&(a(f,k),x(f,e));k=l.cookie("fullName");
null!==k&&0<k.length&&b.find("[data-fn-comments2-input-name]").val(k);b.find(".sv-comment-hidden").attr("title",u("hiddenComment"))}}function m(a){var e=c.getObjectId(a.attr("id"));a.off("click","[data-fn-comment2-toggle-close]");a.on("click","[data-fn-comment2-toggle-close]",function(c){c.preventDefault();c=p.getPortletUri(e,"toggleVisible");l.get(c,function(c){a.find(".sv-comments2-portlet-content").html(c);b(a)})});a.off("click","[data-fn-comment2-toggle-mutable]");a.on("click","[data-fn-comment2-toggle-mutable]",
function(b){b.preventDefault();b=p.getPortletUri(e,"toggleMutable");l.get(b,function(){a.find("[data-sv-comments2-closed-title]").hasClass("sv-hidden")?(a.find("[data-sv-comments2-closed-title]").removeClass("sv-hidden"),a.find(".sv-comments2-form").addClass("sv-hidden"),a.find("[data-sv-comments2-disallow-comments]").addClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").removeClass("sv-hidden")):(a.find("[data-sv-comments2-closed-title]").addClass("sv-hidden"),a.find(".sv-comments2-form").removeClass("sv-hidden"),
a.find("[data-sv-comments2-disallow-comments]").removeClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").addClass("sv-hidden"))})})}var n=window.sv,p=n.PortletUtil,c=n.ObjectUtil,k=n.Events,e=n.KeyUtil,f=e.KEY,l=window.$svjq,s=n.Ajax,h=window.SVBackbone,w=window._sv,q={},v,A,y={triggers:{"@":{source:p.getModelObjectUri(n.PageContext.pageId,"userIdentitySearch",n.PageContext.pageId),searchKey:"term",allowWhiteSpace:!0,maxWhiteSpace:2,parse:function(a){return a.hits}}},minLength:2,replacer:function(a){return a.trigger+
'{"value":"'+a.name+'","id":"'+a.id+'"}'}},u=function(a,b){var c;if(!b&&q[a])return q[a];c=n.i18n.getText("portlet.comments2.comments",a,b);b||(q[a]=c);return c},a=function(a,b){a.find("a[data-user-identity]").each(function(){var a=l(this);a.attr("href",b+"?identity="+a.data("user-identity"))})},x=function(a,b){a.find("a[data-social-tag-id]").each(function(){var a=l(this);a.attr("href",b+"?tag="+encodeURIComponent(a.data("social-tag-name")))})},z=h.Model.extend({defaults:{removeTitle:u("removeCommentTitle"),
editTitle:u("editCommentTitle")},url:function(){return this.collection?this.collection.url()+"&commentId="+this.get("id"):"?commentId="+this.get("id")}}),D=h.Collection.extend({model:z,initialize:function(a,b){this.options=b;this.bindServerEvents()},bindServerEvents:function(){var a=this;k.on("server-pagecomment-added-"+n.PageContext.pageId,function(b){a.add(b.content,{append:!0})})},url:function(){return p.getPortletResourceUri(this.options.portletId,"comment")+"&file="+this.options.id}}),G=h.View.extend({tagName:"li",
className:function(){return this.model.get("hidden")?"sv-comment2-comment sv-comment-hidden":"sv-comment2-comment"},events:{"click [data-fn-destroy-comment]":"showDestroyDialog","click [data-fn-edit-comment]":"editComment","click [data-fn-hide-comment]":"doHide","click [data-fn-show-comment]":"doHide"},initialize:function(){this.listenTo(this.model,"change:comment",this.updateComment,this);this.listenTo(this.model,"destroy",this.remove,this);this.listenTo(this.model,"change:hidden",this.hide,this)},
showDestroyDialog:function(){var a=this;n.DialogUtil.showConfirmDialog(u("removeCommentTitle"),u("removeCommentBody"),function(b){b&&a.model.destroy({wait:!0})});return!1},editComment:function(a){a.preventDefault();s.doGet({context:this,url:p.getPortletResourceUri(this.options.portletId,"comment")+"&commentId="+this.model.get("id")}).done(function(a){this.showEditComment(a.plainMessage,a.mentions)})},showEditComment:function(a,b){var c=this,e=this.model.get("id"),f=l("<div/>"),h=l('<span class="sv-float-right">'+
(v-a.length)+"</span>"),k=l("<textarea/>").attr("id","editComment").addClass("sv-comment-input sv-border-box").on("keyup",w.bind(function(a){a=v-a.currentTarget.value.length;0>a?(h.addClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().addClass("disabled").attr("disabled","disabled")):(h.removeClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().removeClass("disabled").removeAttr("disabled"));h.text(a)},this)).val(a);f.addClass("sv-comments2-portlet").append(k).append(h);
var m=[{text:u("save"),callback:l.proxy(function(){s.doPut({url:p.getPortletResourceUri(c.options.portletId,"comment")+"&commentId="+e,data:{comment:k.triggeredInput("getRichContent")},context:this}).done(function(a){this.model.set(a)})},this)}];n.DialogUtil.showDialog({title:u("editCommentTitle"),body:f,buttons:m,shownCallback:function(){k.triggeredInput(y).triggeredInput("setIds",b).elastic()}});return!1},getSaveEditCommentButton:function(){this.$saveEditButton||(this.$saveEditButton=l(".modal-footer button"));
return this.$saveEditButton},updateComment:function(a){a.get("hidden")&&!a.get("isAdmin")?a.collection.remove(a):(this.render(),k.trigger(k.types.updateLikables,this.$el),k.trigger(k.types.updateRelativeDates,this.$el))},doHide:function(a){a.preventDefault();this.model.set({hidden:!this.model.get("hidden")});this.model.save({},{url:p.getPortletResourceUri(this.model.collection.options.portletId,"toggleVisibleComment")+"&commentId="+this.model.id})},hide:function(){this.model.get("hidden")?(this.$el.addClass("sv-comment-hidden"),
this.$el.attr("title",u("hiddenComment")),this.$el.find("[data-fn-hide-comment]").addClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").removeClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").removeClass("sv-hidden")):(this.$el.removeClass("sv-comment-hidden"),this.$el.removeAttr("title"),this.$el.find("[data-fn-hide-comment]").removeClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").addClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").addClass("sv-hidden"))},
render:function(){this.$el.html(this.options.template(this.model.toJSON()));this.model.toJSON().hidden&&this.$el.attr("title",u("hiddenComment"));a(this.$el,this.options.profilePageURL);x(this.$el,this.options.tagResultPageURL);return this}}),H=h.View.extend({initialize:function(){this.$list=this.$el.find("[data-fn-comments2]");this.collection.on("add",this.addNewComment,this);this.collection.on("remove",this.removeComment,this);this.$el.find("[data-fn-comments2-input]").triggeredInput(y).elastic();
0<this.collection.length&&this.render()},render:function(){this.clearList();this.collection.each(function(a){this.appendOne(a)},this);k.trigger(k.types.updateRelativeDates,this.$el);k.trigger(k.types.updateLikables,this.$el)},clearList:function(){this.$list.empty()},appendOne:function(a){a=(new G({model:a,portletId:this.options.portletId,template:this.options.commentTemplate,profilePageURL:this.options.profilePageURL,tagResultPageURL:this.options.tagResultPageURL})).render().$el;var b=a.find(".sv-comments2-content").find(".sv-truncate-more"),
c;0<b.length&&(this.addShowMoreLink(b),c=!0);this.$list.append(a);c&&this.bindShowMoreEvents(a)},bindShowMoreEvents:function(a){var b=u("showMore"),c=u("showLess"),e=l(".sv-truncate-more-link",a),f=l(".sv-truncate-more",a),h=l(".sv-truncate-ellipsis",a);e.on("click",function(a){a.preventDefault();e.text()===b?(f.show(),e.text(c),h.css("display","none")):(f.hide(),e.text(b),h.css("display","inline"))})},addShowMoreLink:function(a){l('<span class="sv-truncate-ellipsis">...</span>').insertBefore(a);
l('<div><a href="#" class="sv-truncate-more-link">'+u("showMore")+"</a></div>").insertAfter(a);a.css("display","none")},addNewComment:function(a){void 0!==a.toJSON().author?this.appendOne(a):k.trigger(k.types.notifyUser,{type:"default",heading:u("moderatedHeading"),message:u("moderatedBody"),transient:!0});k.trigger(k.types.updateRelativeDates,this.$el);k.trigger(k.types.updateLikables,this.$el)},removeComment:function(a){this.render();a.get("hidden")&&k.trigger(k.types.notifyUser,{type:"default",
heading:u("moderatedHeading"),message:u("moderatedBody"),transient:!0})},getLoader:function(){this.$loader||(this.$loader=l('<img src="/sitevision/util/images/loading_16_grey.gif" />').css("vertical-align","middle").appendTo(this.$el.find("[data-fn-comment-input]").parent()));return this.$loader},events:{"focus [data-fn-comments2-input]":"expandTextfield","click [data-fn-comments2-input]":"expandTextfield","keyup [data-fn-comments2-input]":"countdownCharactersLeft","keyup [data-fn-comments2-input-name]":"countdownCharactersLeft",
"keydown [data-fn-comments2-input]":"checkKeyDown","submit [data-fn-comments2-form]":"postComment"},expandTextfield:function(a){l(a.currentTarget).addClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").show();this.countdownCharactersLeft(a)},shrinkTextfield:function(){this.$el.find(".sv-message-input-expanded").removeClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").hide()},getTextField:function(){this.$textField||(this.$textField=this.$el.find("[data-fn-comments2-input]"));
return this.$textField},countdownCharactersLeft:function(a){a=l(a.currentTarget);var b=a.val(),b=v-b.length,c=this.$el.find("[data-fn-comments2-input-size]");0>b?c.addClass("sv-character-limit-exceeded"):c.removeClass("sv-character-limit-exceeded");c.text(b);""!==a.val()&&0<=b&&!this.activeConnection?this.enableSubmitButton():this.disableSubmitButton()},checkKeyDown:function(a){if(e.getKeyCodeFromEvent(a)===f.RETURN&&a.ctrlKey)return this.getSubmitButton().focus(),this.$el.find("[data-fn-comments2-form]").submit(),
!1},postComment:function(a){var b=this,c,e,f,h;if(!a.isPropagationStopped()&&!a.isDefaultPrevented()){a.preventDefault();if(this.activeConnection)return!1;c=this.$el.find("[data-fn-comments2-input]");h=b.getNameField();a=c.val().length;if(1===h.length&&0===h.val().length)return k.trigger(k.types.notifyUser,{type:"default",heading:u("noNameHeading"),message:u("noNameBody"),transient:!0}),!1;if(0<a&&a<=v){if(A&&(e=(e=this.$el.find("#g-recaptcha-response"))&&e[0].value,!e))return this.$el.find("#sv-help-block-verify").show(),
!1;this.disableSubmitButton();this.activeConnection=!0;e=new z({comment:c.triggeredInput("getRichContent"),fullName:h.val(),useCaptcha:A,recaptchaResponse:e||""});a=b.$el.find("[data-sv-spam-marker]");0<a.length&&(e.attributes[a.attr("name")]=a.val());f=setTimeout(function(){b.getLoader().show()},400);this.collection.create(e,{wait:!0,success:function(){c.val("");b.activeConnection=!1;b.getLoader().hide();clearTimeout(f);l.cookie("fullName",h.val());A&&b.$el.find("#recaptcha-container").hide()},error:function(){b.activeConnection=
!1;b.getLoader().hide();clearTimeout(f);b.enableSubmitButton();k.trigger(k.types.notifyUser,{type:"error",heading:u("postFailedHeading"),message:u("postFailedBody"),transient:!0})}});this.shrinkTextfield()}else a>v&&k.trigger(k.types.notifyUser,{type:"default",heading:u("commentToLongHeading"),message:u("commentToLongBody"),transient:!0});return!1}},getSubmitButton:function(){this.$submitButton||(this.$submitButton=this.$el.find("[data-fn-comments2-submit]"));return this.$submitButton},getNameField:function(){this.$NameField||
(this.$NameField=this.$el.find("[data-fn-comments2-input-name]"));return this.$NameField},disableSubmitButton:function(){this.getSubmitButton().addClass("disabled").attr("disabled","disabled")},nameFieldOK:function(){var a=this.getNameField();return 0===a.length||a.val()?!0:!1},enableSubmitButton:function(){""!==this.getTextField().val()&&this.nameFieldOK()&&this.getSubmitButton().removeClass("disabled").removeAttr("disabled")}});l(".sv-comments2-portlet").each(function(){var a=l(this);b(a)})})();
(function(){function b(b){this.options=b;this.bindLinkListener()}var m=window.$svjq,n=window.sv,p=/^[A-Z0-9._%+\-]+@([A-Z0-9][.\-]?)+[A-Z0-9]+\.[A-Z]{2,6}$/i;b.prototype={bindLinkListener:function(){var b=this;this.options.$portlet.find("."+this.options.linkClass).on("click",function(){b.openDialog.call(b,this);return!1})},getDialogContainer:function(){this.$dialogContainer||(this.$dialogContainer=m("<div/>"));return this.$dialogContainer},showMessageDialog:function(b){this.$subDialogContainer?this.$subDialogContainer.html(b).svDialog("open"):
this.$subDialogContainer=m("<div/>").html(b).svDialog({open:!0,title:this.options.sendMessageTitle,buttons:[{text:this.options.closeButtonText,type:"primary",callback:m.proxy(function(){this.$subDialogContainer.svDialog("close")},this)}]})},validateForm:function(){var b=!0,k=this.getDialogContainer().find("form");m.each(this.options.requiredFields,m.proxy(function(e,l){var m=k.find("[name="+l+"]");this.validateField(m)||(b=!1)},this));if(this.options.attachmentField){var e=k.find("[name=attachment]");
this.checkAttachmentSize(e)||(b=!1)}return b},validateField:function(b){var k=b.is("[name=emailAddress]"),e=b.is("[name=attachment]");if(this.checkRequiredField(b)){if(k&&!this.checkEmailAddress(b))return this.appendErrorMessage(b,this.options.errorMessages.invalidEmail),!1;if(e&&!this.checkAttachmentSize(b))return this.appendErrorMessage(b,this.options.errorMessages.fileSizeExceeded),!1;this.removeValidationErrors(b);return!0}this.appendErrorMessage(b,this.options.errorMessages[b.attr("name")]);
return!1},checkEmailAddress:function(b){if(0===b.length)return!0;b=b.val();return""===m.trim(b)&&-1===m.inArray("emailAddress",this.options.requiredFields)||p.test(b)},checkAttachmentSize:function(b){return 0===b[0].files.length?!0:b[0].files[0].size<this.options.maxMailSize},checkRequiredField:function(b){var k=!1;return-1===m.inArray(b.attr("name"),this.options.requiredFields)?!0:k=b.is("[type=checkbox]")?b.is(":checked")||0<b.siblings("input[type=checkbox]").filter(":checked").length:!!m.trim(b.val())},
appendErrorMessage:function(b,k){b.siblings(".sv-contact2-error-message-container").remove();b.addClass("sv-contact2-warned");var e=m("<label/>",{"for":b.attr("id"),"class":this.options.errorFont}).html('<img alt="" style="border:none; width:16px; height:16px; vertical-align:middle" src="'+this.options.errorImageSrc+'"/> '+k);m('<div class="sv-contact2-error-message-container" />').append(e).appendTo(b.parent())},removeValidationErrors:function(b){(b?b.parent():this.getDialogContainer()).find(".sv-contact2-error-message-container").remove()},
handleSubmit:function(){var b=this.options.ajaxFormUrl,k;this.validateForm()&&(this.options.attachmentField?this.getDialogContainer().find("form").submit():(k=this.getDialogContainer().find("form").serialize(),m.post(b,k,m.proxy(function(b){this.closeDialog();this.showMessageDialog(b)},this))))},closeDialog:function(){this.getDialogContainer().svDialog("close")},buildDialogUrl:function(b){return this.options.ajaxSendBaseUrl+"&contactUserId="+b.substring(3).replace("_",".")},openDialog:function(b){var k=
this.getDialogContainer(),e=k.find(".sv-form-consent");if(this.dialogCreated)k.svDialog("setURL",this.buildDialogUrl(b.id)).svDialog("open"),e.length&&k.svDialog("disableSubmitButton");else{k.svDialog({open:!0,url:this.buildDialogUrl(b.id),title:this.options.sendMessageTitle,modal:this.options.useModalDialog,buttons:[{text:this.options.submitButtonText,type:"primary",callback:m.proxy(this.handleSubmit,this)},{text:this.options.cancelButtonText,type:"link",callback:m.proxy(this.closeDialog,this)}]});
var f=this;k.on("change","input, textarea",function(){f.validateField(m(this))});k.on("change","input[data-sv-form-consent-checkbox]",function(){m(this).is(":checked")?k.svDialog("enableSubmitButton"):k.svDialog("disableSubmitButton")});k.on("open:dialog.sv-dialog",function(){k.find(".sv-form-consent").length&&k.svDialog("disableSubmitButton")});k.on("keyup","input[type=text].sv-contact2-warned, textarea.sv-contact2-warned",function(){f.validateField(m(this))});this.dialogCreated=!0}}};m(".sv-contact2-portlet").each(function(){var c=
m(this),k=n.contact2[this.id.substring(4)];k&&(k.$portlet=c,k=new b(k),c.data("sv-contact2-portlet",k))})})();
(function(){var b=window.$svjq,m={};b(".sv-has-error").each(function(){var m=b(this);m.on("change keyup",function(){m.removeClass("sv-has-error");m.off()})});var n=function(n){var c=n.val();n=m[n.attr("id")];c=n.initialSize-b.trim(c).length;0>c?n.$el.addClass("sv-textfield-limit-exceeded"):n.$el.removeClass("sv-textfield-limit-exceeded");n.$el.text(c)};b(".sv-form-textfield.sv-limit-characters").each(function(){var p=b(this),c=p.parent().find(".sv-textfield-input-size"),k=p.attr("id");m[k]={$el:c,
initialSize:c.text()};p.on("keyup",function(c){n(b(c.currentTarget))});p.val().length&&n(p)});b("form[data-sv-user-consent]").each(function(){var m=b(this),c=m.find("input[type=submit]:not(.sv-survey-next)");c.length&&(m=m.find("[data-sv-form-consent-checkbox]"),c.prop("disabled",!m.is(":checked")),m.on("change",function(){c.prop("disabled",!b(this).is(":checked"))}))})})();
(function(){function b(b,k,e,f,l,n){var h=window.hs,p=m.i18n.getLanguage();if("de"===p||"no"===p||"sv"===p)h.lang=h.lang[p];h.numberingClass=b;b={interval:k,repeat:!0,useControls:!l,fixedControls:"fit"};l||(b.overlayOptions={position:"bottom right",hideOnMouseOut:f,offsetY:e,offsetX:-3});n||(b.thumbstrip={position:"above",mode:"horizontal",relativeTo:"expander"});h.addSlideshow(b)}var m=window.sv,n=window.$svjq,p=window.LazyLoad;m.ImageAlbumUtil={createSlideShow:function(c,k,e,f,l,m){window.hs?b(c,
k,e,f,l,m):(p.css("/sitevision/ajax/highslide/highslide.css"),n.getScript("/sitevision/ajax/highslide/highslide_mod.js",function(){b(c,k,e,f,l,m)}))}}})();
(function(b,m){b.sv=b.sv||{};b.sv.responsiveTables=b.sv.responsiveTables||{};b.sv.responsiveTables.config=b.sv.responsiveTables.config||{};b.sv.responsiveTables.classNames={};b.sv.responsiveTables.selectors={};m.each([["groupName",""],["scroll","--scroll"],["fixedFirst","--fixedFirst"],["stackGroupName","--stacked"],["stackTable","--stackTable"],["stackColumns","--stackColumns"]],function(m,p){b.sv.responsiveTables.classNames[p[0]]="sv-responsiveTable"+p[1];b.sv.responsiveTables.selectors[p[0]]=".sv-responsiveTable"+
p[1]});b.sv.responsiveTables.config=m.extend({},{breakpoint:"767px",fixedFirstWidth:"35%",divClassTmpl:'<div class="<%= classNames %>" />',divStyleTmpl:'<div class="<%= classNames %>" style="<%= styleAttr %>" />',tblTmpl:'<table class="<%= classNames %>"><tbody></tbody></table>',tblThRowTmpl:'<tr class="<%= trClassNames %>"><th class="<%= thClassNames %>" colspan="<%= colSpan %>"><%= content %></th></tr>',tblTrRowTmpl:'<tr class="<%= trClassNames %>"><td class="<%= groupName %>__key"><%= keyContent %></td><td class="<%= groupName %>__value <%= cellClassName %>"><%= valueContent %></td></tr>'},
b.sv.responsiveTables.config)})(window,window.$svjq);
(function(b,m,n,p,c,k){var e=p.classNames,f=p.selectors,l=p.config;(function(){n.svRespTables||(n.svRespTables={});n.svRespTables.scroll=function(b){this.init=function(){n(b).removeClass(e.groupName).wrap(c(l.divClassTmpl,{classNames:e.groupName}))};this.init()};n.fn.svRespTables_scroll=function(){return this.each(function(){new n.svRespTables.scroll(this)})};n.svRespTables.fixedFirst=function(b){var h=this,m=e.groupName+" "+e.fixedFirst,q=p.mql,v=!1;h.$el=n(b);h.$el.data("svRespTables.fixedFirst",
h);h.init=function(){h.$el.removeClass(m).wrap(c(l.divClassTmpl,{classNames:m}))};h.splitTable=function(){h.$copy=h.$el.clone();h.$copy.css("width","100%").find("td:not(:first-child), th:not(:first-child)").hide().end().find("caption").html("&nbsp;");h.$el.closest(".sv-responsiveTable--fixedFirst").append(h.$copy);h.$copy.wrap(c(l.divStyleTmpl,{classNames:e.fixedFirst+"__pinned",styleAttr:"width: "+l.fixedFirstWidth}));h.$el.wrap(c(l.divStyleTmpl,{classNames:e.fixedFirst+"__scrollable",styleAttr:"margin-left: "+
l.fixedFirstWidth}));h.setCellHeights()};h.unSplitTable=function(){h.$el.closest(f.fixedFirst).find(f.fixedFirst+"__pinned").remove();h.$el.unwrap();h.$copy=k;h.unSetCellHeights()};h.setCellHeights=function(){var b=h.$el.find("tr"),c=h.$copy.find("tr"),e=[];b.each(function(a,b){n(b).find("th, td").each(function(){var b=n(this).outerHeight(!0);e[a]=e[a]||0;b>e[a]&&(e[a]=b)})});c.each(function(a,c){n(c).height(e[a]);b.eq(a).height(e[a])})};h.unSetCellHeights=function(){h.$el.find("tr").each(function(b,
c){c.style.height="auto"})};h.updateTables=function(){!q.matches&&v?(v=!1,h.unSplitTable()):q.matches&&!v&&(v=!0,h.splitTable())};q.addListener(h.updateTables);n(h.updateTables);h.init()};n.fn.svRespTables_fixedFirst=function(){return this.each(function(){new n.svRespTables.fixedFirst(this)})};n.svRespTables.stackTable=function(b){var f=this,k=p.mql;f.$el=n(b);f.$el.data("svRespTables.stackTable",f);f.init=function(){var b="",m,p;k.removeListener(f.init);f.$copy=n(c(l.tblTmpl,{classNames:f.$el.prop("class")+
" "+e.stackGroupName+"__smallOnly"}));f.$el.addClass(e.stackGroupName+"__largeOnly");m=f.$el.find("caption").clone();p=f.$el.find("tr").eq(0);f.$el.find("tr").each(function(f,h){var a=n(h),k="",m="",v,s=a.prop("class");0===f?b+=c(l.tblThRowTmpl,{trClassNames:s,thClassNames:e.stackGroupName+"__headRow "+e.stackGroupName+"__headRow--main",colSpan:2,content:a.find("th, td").eq(0).html()}):(a.find("td, th").each(function(a,b){var f=n(b);n.trim(f.html())&&(0===a?k+=c(l.tblThRowTmpl,{trClassNames:s,thClassNames:e.stackGroupName+
"__headRow",colSpan:2,content:f.html()}):(v=n.trim(p.find("td,th").eq(a).html()),m+=c(l.tblTrRowTmpl,{trClassNames:s,groupName:e.stackGroupName,keyContent:v?v:"",cellClassName:f.prop("class"),valueContent:f.html()})))}),b+=k+m)});f.$copy.find("tbody").before(m).html(b);f.$el.before(f.$copy)};k.matches?f.init():k.addListener(f.init)};n.fn.svRespTables_stackTable=function(){return this.each(function(){new n.svRespTables.stackTable(this)})};n.svRespTables.stackColumns=function(b){var f=this,k=p.mql;
f.$el=n(b);f.$el.data("svRespTables.stackColumns",f);f.init=function(){function b(c,a){var f=n(a),h=n("<tr></tr>"),k,l,m;0===c&&h.addClass(e.stackGroupName+"__headRow "+e.stackGroupName+"__headRow--main");k=f.find("td, th").eq(0).clone().addClass(e.stackGroupName+"__key");l=p;f.find("*[colspan]").length&&(m=0,f.find("td, th").each(function(a,b){var c=n(b).attr("colspan");if(m>p)return!1;c?(c=parseInt(c,10),l-=c-1,m+c>p&&(l+=m+c-p-1),m+=c):m++}));f=f.find("td, th").eq(l).clone();f.addClass(e.stackGroupName+
"__value").removeAttr("colspan");h.append(k,f);s.append(h)}var m=f.$el.find("tr").eq(0).find("td, th").length,p=1,s;k.removeListener(f.init);if(!(3>m)){f.$copy=n(c(l.tblTmpl,{classNames:f.$el.prop("class")+" "+e.stackGroupName+"__smallOnly"}));f.$el.addClass(e.stackGroupName+"__largeOnly");f.$el.find("caption").length&&f.$copy.find("tbody").before(f.$el.find("caption").clone());for(s=n("<tbody />");p<m;)f.$el.find("tr").each(b),++p;f.$copy.find("tbody").append(s.html());f.$el.before(f.$copy)}};k.matches?
f.init():k.addListener(f.init)};n.fn.svRespTables_stackColumns=function(){return this.each(function(){new n.svRespTables.stackColumns(this)})}})()})(window,window.document,window.$svjq,window.sv.responsiveTables,window.sv.TemplateUtil.template);
(function(b,m,n,p,c){var k,e=c.selectors;c.init=function(){var b=n(m.getElementsByTagName("table")).filter(e.groupName);0<b.length&&(c.appendCSS(),b.filter(e.scroll).svRespTables_scroll().end().filter(e.fixedFirst).svRespTables_fixedFirst().end().filter(e.stackTable).svRespTables_stackTable().end().filter(e.stackColumns).svRespTables_stackColumns())};n(function(){k=n(m.body);b.matchMedia&&k.hasClass("sv-responsive")&&!k.hasClass("sv-editing-mode")&&(c.mql=window.matchMedia("(max-width: "+c.config.breakpoint+
")"),c.init())})})(window,window.document,window.$svjq,window.sv,window.sv.responsiveTables);
(function(b,m){var n,p;function c(b){var c=document.createElement("style");c.appendChild(document.createTextNode(""));document.head.appendChild(c);b&&c.setAttribute("media","(max-width: "+b+")");return c.sheet}n=["div.sv-responsiveTable { overflow: auto; max-width: 100%; }","div.sv-responsiveTable * { white-space: nowrap !important; }","div.sv-responsiveTable--fixedFirst { position: relative; margin-bottom: 20px; overflow: hidden; border-right: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst table { margin-bottom: 0; overflow: visible; max-width: none; }",
"div.sv-responsiveTable--fixedFirst td, div.sv-responsiveTable--fixedFirst th { position: relative; overflow: hidden; }","div.sv-responsiveTable--fixedFirst__scrollable th:first-child, div.sv-responsiveTable--fixedFirst__scrollable td:first-child { display: none; }","div.sv-responsiveTable--fixedFirst__pinned { position: absolute; left: 0; top: 0; background: #fff; overflow: hidden; overflow-x: scroll; border-right: 1px solid #ccc; border-left: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst__pinned table { border-right: none; border-left: none; width: 100%; }",
"div.sv-responsiveTable--fixedFirst__pinned td:first-child, div.sv-responsiveTable--fixedFirst__pinned th:first-child { width: 100%; }","div.sv-responsiveTable--fixedFirst__scrollable { overflow: scroll; overflow-y: hidden; }",".sv-responsiveTable--stacked { overflow: visible; }",".sv-responsiveTable--stacked__largeOnly { display: none; }",".sv-responsiveTable--stacked__smallOnly { display: table; }"];p=[".sv-responsiveTable--stacked__largeOnly { display: table; }",".sv-responsiveTable--stacked__smallOnly { display: none; }"];
m.appendCSS=function(){var k=c(),e=c(m.config.breakpoint);b.each(p,function(b,c){k.insertRule(c,b)});b.each(n,function(b,c){e.insertRule(c,b)})}})(window.$svjq,window.sv.responsiveTables);
(function(){var b=window.$svjq,m=window.sv,n=window._sv,p,c=function(c){var e=c.portletId,f=c.inputField,l=c.resultDiv,s=-1,h=-1,w=function(){l.hide()};b("body").bind("click",w);var q=function(a,b){if(-1<a){var c=b.find(".sv-searchform2-search-list-column"+a);if(1===c.length)return c}},v=function(a,c){if(-1<a&&a<c.children().length)return b(c.children()[a])},A=function(a,b,c){a=q(a,c);if(void 0!==a)return v(b,a)},y=function(a){var b=0,c=q(0,a),e=q(1,a);a=q(2,a);void 0!==c&&b++;void 0!==e&&b++;void 0!==
a&&b++;return b},u=function(a){a.children().removeClass("active")};f.keydown(function(a){a=m.KeyUtil.getKeyCodeFromEvent(a);var b=q(0,l),c=q(1,l),e=q(2,l);void 0!==b&&void 0!==c&&(a===m.KeyUtil.KEY.RIGHT&&0===h?(h=1,s=-1,u(b),u(e),a=m.KeyUtil.KEY.DOWN):a===m.KeyUtil.KEY.LEFT&&1===h?(h=0,s=-1,u(c),u(e),a=m.KeyUtil.KEY.DOWN):a===m.KeyUtil.KEY.RIGHT&&1===h?(h=2,s=-1,u(b),u(c),a=m.KeyUtil.KEY.DOWN):a===m.KeyUtil.KEY.LEFT&&2===h&&(h=1,s=-1,u(b),u(e),a=m.KeyUtil.KEY.DOWN));if(a===m.KeyUtil.KEY.DOWN||a===
m.KeyUtil.KEY.UP){var f;0===h&&void 0!==b?f=b:1===h&&void 0!==c?f=c:2===h&&void 0!==e?f=e:-1===h&&(e=l.hasClass("sv-searchform2-result-container-alignment-left")?"left":"right","left"===e?void 0!==b&&(h=0,f=b):void 0!==c?(h=1,f=c):void 0!==b&&(h=0,f=b));a===m.KeyUtil.KEY.DOWN&&void 0!==f&&s+1<f.children().length?(a=v(s+1,f),s++,u(f),a.addClass("active")):a===m.KeyUtil.KEY.UP&&void 0!==f&&-1<s&&(s--,u(f),0<=s?v(s,f).addClass("active"):h=-1);return!1}}).keyup(function(a){a=m.KeyUtil.getKeyCodeFromEvent(a);
a===m.KeyUtil.KEY.ESC?w():a===m.KeyUtil.KEY.RETURN?(a=A(h,s,l),void 0!==a?location.href=a.find("a").attr("href"):1===y(l)&&(a=q(0,l).find(".sv-searchform2-more-hits"),1===a.length&&(location.href=a.find("a").attr("href")))):m.KeyUtil.isNonTextModifiableKeyCode(a)||(void 0!==p&&clearTimeout(p),p=setTimeout(function(){var a=f.val();h=s=-1;if(""===a||2>a.length)l.css("display","none");else{var c=m.PortletUtil.getPortletResourceUri(e,"query");b.ajax({url:c,data:{term:a}}).fail(function(a){l.html('<div class="sv-searchform2-message">'+
m.i18n.getText("portlet.search.searchform2.searchform2","searchFailed",a.status)+"</div>")}).done(function(c){if(a===c.term){var e=c.facets;l.empty();l.css("width","auto");if(0===e.length)e=n.template('<div class="sv-searchform2-message">   <<%= noHitsTag %> class="<%= noHitsClass %>"><%= noHitsText %></<%= noHitsTag %>></div>'),l.append(b(e(c)));else{var k=document.documentElement.clientWidth,q=c.width/2,p=c.contentColumns,v=q*e.length,w=!1,A=!1,z="";v>k&&(300<k?(q=k/2,v=q*e.length):v=q>k?q=k:q);
for(k=0;k<e.length;k++){var y=e[k],C;"content"===y.type?(w=!0,C='<div class="sv-border-box sv-searchform2-facet-column'+k+'" style="width: '+q+'px">   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+k+'">      <% _.each(hits, function(hit){ %>         <li class="sv-searchform2-search-hit sv-wrap-words"><a class="sv-vamiddle <%= contentTagClass %>" href="<%= hit.URL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a><% if (typeof(hit.iconURL) !== \'undefined\') { %><img alt="<%= hit.iconDescription %>" class="sv-noborder-vamiddle" src="<%= hit.iconURL %>" style="margin-left: 3px;"><% } %></li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>'):
"ugc"===y.type?(w=!0,C='<div class="sv-border-box sv-searchform2-facet-column'+k+'" style="width: '+q+'px">   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+k+'">      <% _.each(hits, function(hit){ %>         <li class="sv-clearfix sv-searchform2-search-hit sv-wrap-words">            <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />            <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>            <div class="sv-searchform2-user-container">               <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.entryURL %>" onclick="<%= hit.onClick %>"><%= hit.entryText %></a></<%= userBlockTag %>>               <% if (typeof(hit.userfields) !== \'undefined\') { %>                  <ul class="sv-searchform2-userfield-list">                     <% _.each(hit.userfields, function(userfield){ %>                        <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                     <% }); %>                  </ul>               <% } %>            </div>         </li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>'):
"users"===y.type?(C='<div class="sv-border-box sv-searchform2-content-container">   <<%= facetTag %> class="sv-searchform2-content-header <%= facetTagClass %>"><%- name %></<%= facetTag %>>   <div class="sv-border-box sv-searchform2-facet-column'+k+'" style="width: '+q+'px">      <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+k+'">         <% _.each(hits, function(hit){ %>            <li class="sv-clearfix sv-searchform2-search-hit">               <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />               <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>               <div class="sv-searchform2-user-container">                  <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.profileURL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a></<%= userBlockTag %>>                  <% if (typeof(hit.userfields) !== \'undefined\') { %>                     <ul class="sv-searchform2-userfield-list">                        <% _.each(hit.userfields, function(userfield){ %>                           <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                        <% }); %>                     </ul>                  <% } %>               </div>            </li>         <% }); %>         <% if (showDetails) { %>            <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>         <% } %>      </ul>   </div></div>',
w=!1):(C="",m.Log.error("Skipping unsupported facet type "+y.type));l.css("width",v);w?(A||(C='<div class="sv-border-box sv-searchform2-content-container" style="width: '+q*p+'px">   <<%= facetTag %> class="sv-searchform2-content-header <%= facetTagClass %>"><%- name %></<%= facetTag %>>'+C),A=!0):A&&(C="</div>"+C);C=n.template(C);z+=C(y)}l.append(b(z));var F=l.find("ul.sv-user-search-list");F.find("li.sv-searchform2-search-hit").mouseenter(function(){var a=b(this),c=a.parent();h=c.hasClass("sv-searchform2-search-list-column0")?
0:c.hasClass("sv-searchform2-search-list-column1")?1:c.hasClass("sv-searchform2-search-list-column2")?2:-1;s=a.index();u(F);a.addClass("active")}).mouseleave(function(){s=h=-1;b(this).removeClass("active")}).click(function(a){b(a.target).is("a")||(a=b(this),location.href=a.find("a").attr("href"))})}e=c.facetAlignment+" top";c=c.facetAlignment+" bottom";l.show();l.position({my:e,at:c,of:f,offset:"0 1",collision:"none"})}})}},200));return!1})};b(".sv-searchform2-portlet").each(function(){var k=b(this),
e=m.ObjectUtil.getObjectId(k.attr("id")),f=k.find(".sv-searchform2-result-container"),k=k.find(".sv-searchform2-input");k.attr("autocomplete","off");c({portletId:e,inputField:k,resultDiv:f})})})();
(function(){var b=window.$svjq,m=window.sv,n=m.ObjectUtil,p=m.PortletUtil,c=window.SVBackbone,m=c.Model.extend({getViewUrl:function(){return this.get("url")},isFolder:function(){return this.get("isFolder")}}),k=c.Collection.extend({model:m,initialize:function(b,c){this.portletId=c.portletId;this.currentFolderProps=c.currentFolderProps},url:function(){return p.getPortletResourceUri(this.portletId,"files")},setCurrentFolderProps:function(b){this.currentFolderProps=b},getCurrentFolderProps:function(){return this.currentFolderProps},
parse:function(b){this.setCurrentFolderProps(b.currentFolderProps);return b.items}}),e=c.View.extend({tagName:"tr",events:{"click [data-fetch-item]":"fetchItem"},initialize:function(){this.template=this.options.template;this.model.set("fontClass",this.model.isFolder()?this.options.folderFontClass:this.options.fileFontClass);this.portletView=this.options.portletView},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchItem:function(b){this.model.isFolder()&&
(b.preventDefault(),this.portletView.fetchFolder(this.model))}}),f=c.View.extend({initialize:function(){this.itemTemplate=this.options.itemTemplate;this.fileFontClass=this.options.fileFontClass;this.folderFontClass=this.options.folderFontClass;this.portletView=null},render:function(){this.clearTable();this.collection.each(function(b){this.appendOne(b)},this)},appendOne:function(b){b=new e({model:b,template:this.itemTemplate,portletView:this.portletView,fileFontClass:this.fileFontClass,folderFontClass:this.folderFontClass});
this.$el.append(b.render().el)},clearTable:function(){this.$el.empty()}}),l=m.extend({isFolder:function(){return!0}}),s=c.View.extend({tagName:"li",events:{"click [data-fetch-folder]":"fetchFolder"},initialize:function(){this.template=this.options.template;this.portletView=this.options.portletView;this.model.set("isActive",this.options.isActive)},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchFolder:function(b){b.preventDefault();this.portletView.fetchFolder(this.model)}}),
h=c.View.extend({initialize:function(){this.breadcrumbTemplate=this.options.breadcrumbTemplate;this.portletView=null},render:function(){this.clearList();this.collection.each(function(b,c){this.appendOne(b,c===this.collection.length-1)},this)},appendOne:function(b,c){var e=new s({model:b,template:this.breadcrumbTemplate,portletView:this.portletView,isActive:c});this.$el.append(e.render().el)},clearList:function(){this.$el.empty()}}),w=c.View.extend({initialize:function(){this.breadcrumbCollectionView=
this.options.breadcrumbCollectionView;this.breadcrumbCollection=this.breadcrumbCollectionView.collection;this.itemCollectionView=this.options.itemCollectionView;this.itemCollection=this.itemCollectionView.collection;this.breadcrumbCollectionView.portletView=this;this.itemCollectionView.portletView=this},render:function(){this.breadcrumbCollectionView.render();this.itemCollectionView.render()},fetchFolder:function(b){var c=this.itemCollection.getCurrentFolderProps();this.itemCollection.fetch({data:{sharePointFolderId:b.id,
trail:c.trail,trailTime:c.trailTime},context:this}).done(function(c){c.unauthorized?window.location.href=b.getViewUrl():(this.breadcrumbCollection.reset(c.breadcrumbs),this.render())})}});b(".sv-sharepointfile-portlet").each(function(){var e=b(this),m=n.getObjectId(e.attr("id")),s=e.find(".sv-sharepointfile-root"),y=s.data("js-namespace"),u=window.sv[y]||[];if(0!==u.length){var a=s.find(".sv-sharepointfile-breadcrumbs"),s=s.find(".sv-sharepointfile-files tbody"),y=s.data("file-font-class"),x=s.data("folder-font-class"),
z=u.items,D=u.currentFolderProps,G=u.breadcrumbs,u=p.getTemplate(e,"sharepointitem"),e=p.getTemplate(e,"sharepointbreadcrumb"),G=new c.Collection(G,{model:l}),a=new h({el:a,collection:G,breadcrumbTemplate:e}),m=new k(z,{portletId:m,currentFolderProps:D}),m=new f({el:s,collection:m,breadcrumbCollectionView:a,fileFontClass:y,folderFontClass:x,itemTemplate:u});(new w({breadcrumbCollectionView:a,itemCollectionView:m})).render()}})})();
(function(){var b=window.$svjq,m=window.sv;b(".sv-sharepointfile-portlet, .sv-sharepointsearchfilelist-portlet").each(function(){var n=b(this),p=n.find(".sv-sharepoint-login-modal");p.svDialog({title:m.i18n.getText("portlet.sharepoint.sharepointfile","connectToSharePoint"),open:!1,modal:!0,buttons:[{text:m.i18n.getText("portlet.sharepoint.sharepointfile","loginButton"),type:"primary",callback:function(b){b.preventDefault();p.find("form").submit()}},{text:m.i18n.getText("common","cancel"),type:"link",
callback:function(){p.svDialog("close")}}]});n.find(".sv-sharepoint-modal-button").click(function(){p.svDialog("open")})})})();
(function(){function b(){l&&0!==l.length||(l=k("<div/>"));return l}function m(c){c.preventDefault();c=b().find("form");k.post(c.attr("action"),c.serialize(),function(c){n();-1!==c.indexOf('http-equiv="Refresh"')?window.location.href=k("input[name=redirectURL]").attr("value"):0<k(c).find("div#error-messages").length?l=k("<div/>").html(c).svDialog({open:!0,title:k("input[name=windowTitle]").attr("value"),buttons:[{text:k("input[name=buttonText]").attr("value"),type:"primary",callback:m},{text:k("input[name=closeButtonText]").attr("value"),
type:"link",callback:n}]}):(l=b(),s?s.html(c).svDialog("open"):s=k("<div/>").html(c).svDialog({open:!0,title:k("input[name=windowTitle]").attr("value"),buttons:[{text:k("input[name=closeButtonText]").attr("value"),type:"primary",callback:p}]}))})}function n(){l.svDialog("remove")}function p(){s.svDialog("close")}function c(c){c=k("#"+c);l=b();c.on("click",function(b){b.preventDefault();l.svDialog({open:!0,url:this.href,title:k("input[name=windowTitle]").attr("value"),modal:!0,buttons:[{text:k("input[name=buttonText]").attr("value"),
type:"primary",callback:m},{text:k("input[name=closeButtonText]").attr("value"),type:"link",callback:n}]})})}var k=window.$svjq,e=window.sv,f,l,s;if(e.tellfriend2&&e.tellfriend2.length)for(f=0;f<e.tellfriend2.length;f+=1)c(e.tellfriend2[f])})();
